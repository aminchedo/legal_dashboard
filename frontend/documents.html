<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدیریت اسناد | سامانه هوشمند</title>
    
    <!-- Preconnect for better performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- فونت و آیکون‌ها -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <span class="logo-text">داشبورد حقوقی</span>
                </a>
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="main-nav">
                <div class="nav-section">
                    <h4 class="nav-title">اصلی</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link" data-nav="dashboard">
                                <span class="nav-icon"><i class="fas fa-tachometer-alt"></i></span>
                                <span>داشبورد</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="documents.html" class="nav-link active" data-nav="documents">
                                <span class="nav-icon"><i class="fas fa-file-alt"></i></span>
                                <span>مدیریت اسناد</span>
                                <span class="nav-badge" data-badge="documents">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="upload.html" class="nav-link" data-nav="upload">
                                <span class="nav-icon"><i class="fas fa-cloud-upload-alt"></i></span>
                                <span>آپلود فایل</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="search.html" class="nav-link" data-nav="search">
                                <span class="nav-icon"><i class="fas fa-search"></i></span>
                                <span>جستجو</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="analytics.html" class="nav-link" data-nav="analytics">
                                <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                                <span>تحلیل و گزارش</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="recent-activity.html" class="nav-link" data-nav="recentActivity">
                                <span class="nav-icon"><i class="fas fa-history"></i></span>
                                <span>فعالیت‌های اخیر</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h4 class="nav-title">سیستم</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="system-health.html" class="nav-link" data-nav="systemHealth">
                                <span class="nav-icon"><i class="fas fa-heartbeat"></i></span>
                                <span>وضعیت سیستم</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="settings.html" class="nav-link" data-nav="settings">
                                <span class="nav-icon"><i class="fas fa-cog"></i></span>
                                <span>تنظیمات</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="scraping.html" class="nav-link" data-nav="scraping">
                                <span class="nav-icon"><i class="fas fa-spider"></i></span>
                                <span>استخراج محتوا</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="reports.html" class="nav-link" data-nav="reports">
                                <span class="nav-icon"><i class="fas fa-file-alt"></i></span>
                                <span>گزارش‌ها</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 class="header-title">مدیریت اسناد</h1>
                <div class="header-actions">
                    <div class="search-bar">
                        <input type="text" placeholder="جستجو در اسناد..." class="form-input search-input" id="document-search">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <button class="btn btn-primary" id="upload-btn">
                        <i class="fas fa-plus"></i>
                        آپلود سند
                    </button>
                    <button class="btn-icon" id="user-menu-btn">
                        <i class="fas fa-user-circle"></i>
                    </button>
                    <button class="btn-icon" id="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-badge">0</span>
                    </button>
                </div>
            </header>

            <!-- Breadcrumbs -->
            <div class="breadcrumb-container" id="breadcrumb-container">
                <a href="index.html" class="breadcrumb-item">
                    <i class="fas fa-home"></i>
                    <span>خانه</span>
                </a>
                <i class="fas fa-angle-left mx-2 text-gray-400"></i>
                <span class="breadcrumb-item active" aria-current="page">مدیریت اسناد</span>
            </div>

            <!-- Filters and Controls -->
            <section class="filters-section">
                <div class="filters-container">
                    <div class="filter-group">
                        <label for="type-filter">نوع سند:</label>
                        <select id="type-filter" class="form-select">
                            <option value="">همه انواع</option>
                            <option value="pdf">PDF</option>
                            <option value="doc">Word</option>
                            <option value="image">تصویر</option>
                            <option value="other">سایر</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="status-filter">وضعیت:</label>
                        <select id="status-filter" class="form-select">
                            <option value="">همه وضعیت‌ها</option>
                            <option value="completed">تکمیل شده</option>
                            <option value="processing">در حال پردازش</option>
                            <option value="pending">در انتظار</option>
                            <option value="error">خطا</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="date-filter">تاریخ:</label>
                        <select id="date-filter" class="form-select">
                            <option value="">همه تاریخ‌ها</option>
                            <option value="today">امروز</option>
                            <option value="week">این هفته</option>
                            <option value="month">این ماه</option>
                            <option value="year">این سال</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="sort-filter">مرتب‌سازی:</label>
                        <select id="sort-filter" class="form-select">
                            <option value="date-desc">تاریخ (جدیدترین)</option>
                            <option value="date-asc">تاریخ (قدیمی‌ترین)</option>
                            <option value="name-asc">نام (الف-ی)</option>
                            <option value="name-desc">نام (ی-الف)</option>
                            <option value="size-desc">حجم (بزرگترین)</option>
                            <option value="size-asc">حجم (کوچکترین)</option>
                        </select>
                    </div>
                </div>
                <div class="view-controls">
                    <button class="btn-icon" id="grid-view-btn" data-view="grid">
                        <i class="fas fa-th"></i>
                    </button>
                    <button class="btn-icon" id="list-view-btn" data-view="list">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </section>

            <!-- Bulk Actions -->
            <section class="bulk-actions" id="bulk-actions" style="display: none;">
                <div class="bulk-info">
                    <span id="selected-count">0</span> سند انتخاب شده
                </div>
                <div class="bulk-buttons">
                    <button class="btn btn-secondary" id="bulk-download">
                        <i class="fas fa-download"></i>
                        دانلود
                    </button>
                    <button class="btn btn-warning" id="bulk-tag">
                        <i class="fas fa-tags"></i>
                        برچسب
                    </button>
                    <button class="btn btn-danger" id="bulk-delete">
                        <i class="fas fa-trash"></i>
                        حذف
                    </button>
                </div>
            </section>

            <!-- Documents Grid/List -->
            <section class="documents-section">
                <div class="documents-container" id="documents-container">
                    <!-- Documents will be loaded here dynamically -->
                </div>
                
                <!-- Loading State -->
                <div class="loading-state" id="loading-state">
                    <div class="loading-spinner"></div>
                    <p>در حال بارگذاری اسناد...</p>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="empty-state" style="display: none;">
                    <i class="fas fa-file-alt"></i>
                    <h3>هیچ سندی یافت نشد</h3>
                    <p>برای شروع، اولین سند خود را آپلود کنید</p>
                    <button class="btn btn-primary" id="first-upload-btn">
                        <i class="fas fa-plus"></i>
                        آپلود اولین سند
                    </button>
                </div>
            </section>

            <!-- Pagination -->
            <section class="pagination-section">
                <div class="pagination" id="pagination">
                    <!-- Pagination will be generated dynamically -->
                </div>
            </section>
        </main>
    </div>

    <!-- Notification Panel -->
    <div id="notification-panel" class="notification-panel hidden">
        <div class="notification-header">
            <h3>اعلان‌ها</h3>
            <button class="close-btn" id="close-notification-panel">×</button>
        </div>
        <div class="notification-list" id="notification-list"></div>
        <div class="notification-footer">
            <button class="btn btn-secondary" id="mark-all-read">علامت‌گذاری همه</button>
            <button class="btn btn-danger" id="clear-all-notifications">پاک کردن همه</button>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay hidden"></div>

    <!-- Document Preview Modal -->
    <div id="document-preview-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="preview-title">پیش‌نمایش سند</h3>
                <button class="close-btn" id="close-preview-modal">×</button>
            </div>
            <div class="modal-body">
                <div id="preview-content">
                    <!-- Preview content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="download-preview-btn">
                    <i class="fas fa-download"></i>
                    دانلود
                </button>
                <button class="btn btn-primary" id="edit-preview-btn">
                    <i class="fas fa-edit"></i>
                    ویرایش
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/core.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/state-manager.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/document-manager.js"></script>
    <script src="js/file-handler.js"></script>
    <script src="js/search-engine.js"></script>
    <script src="js/chart-manager.js"></script>

    <!-- Initialize Documents Page -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing Documents Management Page...');

            // Initialize all managers
            const managers = {
                core: window.dashboardCore,
                api: window.apiClient,
                state: window.stateManager,
                navigation: window.navigationManager,
                notifications: window.notificationManager,
                documents: window.documentManager,
                files: window.fileHandler,
                search: window.searchEngine,
                charts: window.chartManager
            };

            // Set up cross-component communication
            managers.core.broadcast('documents:initialized', { managers });

            // Initialize documents page functionality
            initializeDocumentsPage();

            console.log('✅ Documents page initialized successfully');
        });

        function initializeDocumentsPage() {
            // Load documents
            loadDocuments();

            // Set up event listeners
            setupDocumentEventListeners();

            // Set up filters
            setupFilters();

            // Set up view controls
            setupViewControls();

            // Set up bulk actions
            setupBulkActions();
        }

        function loadDocuments() {
            if (window.documentManager) {
                window.documentManager.loadDocuments();
            } else {
                // Fallback loading
                showLoadingState();
                setTimeout(() => {
                    hideLoadingState();
                    showEmptyState();
                }, 2000);
            }
        }

        function setupDocumentEventListeners() {
            // Search functionality
            const searchInput = document.getElementById('document-search');
            if (searchInput) {
                searchInput.addEventListener('input', debounce((e) => {
                    const query = e.target.value.trim();
                    if (query.length > 2) {
                        window.searchEngine.performSearch(query);
                    } else if (query.length === 0) {
                        loadDocuments(); // Reset to show all documents
                    }
                }, 300));
            }

            // Upload button
            const uploadBtn = document.getElementById('upload-btn');
            if (uploadBtn) {
                uploadBtn.addEventListener('click', () => {
                    window.location.href = 'upload.html';
                });
            }

            // First upload button
            const firstUploadBtn = document.getElementById('first-upload-btn');
            if (firstUploadBtn) {
                firstUploadBtn.addEventListener('click', () => {
                    window.location.href = 'upload.html';
                });
            }

            // Mobile menu toggle
            const mobileToggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');

            if (mobileToggle && sidebar) {
                mobileToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('open');
                    overlay.classList.toggle('hidden');
                });
            }

            if (overlay) {
                overlay.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    overlay.classList.add('hidden');
                });
            }

            // Notification panel
            const notificationBell = document.getElementById('notification-bell');
            const notificationPanel = document.getElementById('notification-panel');
            const closePanel = document.getElementById('close-notification-panel');

            if (notificationBell && notificationPanel) {
                notificationBell.addEventListener('click', () => {
                    notificationPanel.classList.toggle('hidden');
                });
            }

            if (closePanel && notificationPanel) {
                closePanel.addEventListener('click', () => {
                    notificationPanel.classList.add('hidden');
                });
            }

            // Document preview modal
            const previewModal = document.getElementById('document-preview-modal');
            const closePreviewBtn = document.getElementById('close-preview-modal');

            if (closePreviewBtn && previewModal) {
                closePreviewBtn.addEventListener('click', () => {
                    previewModal.classList.add('hidden');
                });
            }

            if (previewModal) {
                previewModal.addEventListener('click', (e) => {
                    if (e.target === previewModal) {
                        previewModal.classList.add('hidden');
                    }
                });
            }
        }

        function setupFilters() {
            const filters = ['type-filter', 'status-filter', 'date-filter', 'sort-filter'];
            
            filters.forEach(filterId => {
                const filter = document.getElementById(filterId);
                if (filter) {
                    filter.addEventListener('change', () => {
                        applyFilters();
                    });
                }
            });
        }

        function applyFilters() {
            const filters = {
                type: document.getElementById('type-filter')?.value || '',
                status: document.getElementById('status-filter')?.value || '',
                date: document.getElementById('date-filter')?.value || '',
                sort: document.getElementById('sort-filter')?.value || 'date-desc'
            };

            if (window.documentManager) {
                window.documentManager.applyFilters(filters);
            }
        }

        function setupViewControls() {
            const gridBtn = document.getElementById('grid-view-btn');
            const listBtn = document.getElementById('list-view-btn');
            const container = document.getElementById('documents-container');

            if (gridBtn && listBtn && container) {
                gridBtn.addEventListener('click', () => {
                    setViewMode('grid');
                    gridBtn.classList.add('active');
                    listBtn.classList.remove('active');
                });

                listBtn.addEventListener('click', () => {
                    setViewMode('list');
                    listBtn.classList.add('active');
                    gridBtn.classList.remove('active');
                });

                // Set default view
                setViewMode('grid');
                gridBtn.classList.add('active');
            }
        }

        function setViewMode(mode) {
            const container = document.getElementById('documents-container');
            if (container) {
                container.className = `documents-container ${mode}-view`;
                localStorage.setItem('documents-view-mode', mode);
            }
        }

        function setupBulkActions() {
            const bulkActions = document.getElementById('bulk-actions');
            const selectedCount = document.getElementById('selected-count');
            const bulkDownload = document.getElementById('bulk-download');
            const bulkTag = document.getElementById('bulk-tag');
            const bulkDelete = document.getElementById('bulk-delete');

            if (bulkDownload) {
                bulkDownload.addEventListener('click', () => {
                    if (window.documentManager) {
                        window.documentManager.bulkDownload();
                    }
                });
            }

            if (bulkTag) {
                bulkTag.addEventListener('click', () => {
                    if (window.documentManager) {
                        window.documentManager.bulkTag();
                    }
                });
            }

            if (bulkDelete) {
                bulkDelete.addEventListener('click', () => {
                    if (window.documentManager) {
                        window.documentManager.bulkDelete();
                    }
                });
            }
        }

        function showLoadingState() {
            const loadingState = document.getElementById('loading-state');
            const emptyState = document.getElementById('empty-state');
            const container = document.getElementById('documents-container');

            if (loadingState) loadingState.style.display = 'flex';
            if (emptyState) emptyState.style.display = 'none';
            if (container) container.style.display = 'none';
        }

        function hideLoadingState() {
            const loadingState = document.getElementById('loading-state');
            if (loadingState) loadingState.style.display = 'none';
        }

        function showEmptyState() {
            const emptyState = document.getElementById('empty-state');
            const container = document.getElementById('documents-container');
            const loadingState = document.getElementById('loading-state');

            if (emptyState) emptyState.style.display = 'flex';
            if (container) container.style.display = 'none';
            if (loadingState) loadingState.style.display = 'none';
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>