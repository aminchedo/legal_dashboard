<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحلیل و گزارش | سامانه هوشمند</title>
    
    <!-- Preconnect for better performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- فونت و آیکون‌ها -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <span class="logo-text">داشبورد حقوقی</span>
                </a>
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="main-nav">
                <div class="nav-section">
                    <h4 class="nav-title">اصلی</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link" data-nav="dashboard">
                                <span class="nav-icon"><i class="fas fa-tachometer-alt"></i></span>
                                <span>داشبورد</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="documents.html" class="nav-link" data-nav="documents">
                                <span class="nav-icon"><i class="fas fa-file-alt"></i></span>
                                <span>مدیریت اسناد</span>
                                <span class="nav-badge" data-badge="documents">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="upload.html" class="nav-link" data-nav="upload">
                                <span class="nav-icon"><i class="fas fa-cloud-upload-alt"></i></span>
                                <span>آپلود فایل</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="search.html" class="nav-link" data-nav="search">
                                <span class="nav-icon"><i class="fas fa-search"></i></span>
                                <span>جستجو</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="analytics.html" class="nav-link active" data-nav="analytics">
                                <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                                <span>تحلیل و گزارش</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h4 class="nav-title">سیستم</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="system-health.html" class="nav-link" data-nav="systemHealth">
                                <span class="nav-icon"><i class="fas fa-heartbeat"></i></span>
                                <span>وضعیت سیستم</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="settings.html" class="nav-link" data-nav="settings">
                                <span class="nav-icon"><i class="fas fa-cog"></i></span>
                                <span>تنظیمات</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 class="header-title">تحلیل و گزارش</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" id="export-report-btn">
                        <i class="fas fa-download"></i>
                        صادرات گزارش
                    </button>
                    <button class="btn btn-primary" id="refresh-analytics-btn">
                        <i class="fas fa-sync-alt"></i>
                        بروزرسانی
                    </button>
                    <button class="btn-icon" id="user-menu-btn">
                        <i class="fas fa-user-circle"></i>
                    </button>
                    <button class="btn-icon" id="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-badge">0</span>
                    </button>
                </div>
            </header>

            <!-- Breadcrumbs -->
            <div class="breadcrumb-container" id="breadcrumb-container">
                <a href="index.html" class="breadcrumb-item">
                    <i class="fas fa-home"></i>
                    <span>خانه</span>
                </a>
                <i class="fas fa-angle-left mx-2 text-gray-400"></i>
                <span class="breadcrumb-item active" aria-current="page">تحلیل و گزارش</span>
            </div>

            <!-- Analytics Overview -->
            <section class="analytics-overview">
                <div class="overview-grid">
                    <div class="overview-card">
                        <div class="overview-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="overview-content">
                            <div class="overview-value" id="total-documents">1,234</div>
                            <div class="overview-label">کل اسناد</div>
                            <div class="overview-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+12% این ماه</span>
                            </div>
                        </div>
                    </div>

                    <div class="overview-card">
                        <div class="overview-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="overview-content">
                            <div class="overview-value" id="processing-rate">98.5%</div>
                            <div class="overview-label">نرخ موفقیت</div>
                            <div class="overview-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+2.3% این هفته</span>
                            </div>
                        </div>
                    </div>

                    <div class="overview-card">
                        <div class="overview-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="overview-content">
                            <div class="overview-value" id="avg-processing-time">2.3</div>
                            <div class="overview-label">میانگین زمان (دقیقه)</div>
                            <div class="overview-change negative">
                                <i class="fas fa-arrow-down"></i>
                                <span>-0.5 دقیقه</span>
                            </div>
                        </div>
                    </div>

                    <div class="overview-card">
                        <div class="overview-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="overview-content">
                            <div class="overview-value" id="active-users">45</div>
                            <div class="overview-label">کاربران فعال</div>
                            <div class="overview-change positive">
                                <i class="fas fa-arrow-up"></i>
                                <span>+8 این هفته</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Charts Section -->
            <section class="charts-section">
                <div class="charts-grid">
                    <!-- Document Trends Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>روند اسناد</h3>
                            <div class="chart-actions">
                                <select class="form-select" id="trend-period">
                                    <option value="7">7 روز گذشته</option>
                                    <option value="30" selected>30 روز گذشته</option>
                                    <option value="90">90 روز گذشته</option>
                                    <option value="365">یک سال</option>
                                </select>
                                <button class="btn-icon" data-chart-action="refresh" data-chart="trends">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn-icon" data-chart-action="export" data-chart="trends">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="documentTrendsChart"></canvas>
                        </div>
                    </div>

                    <!-- Document Types Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>توزیع نوع اسناد</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" data-chart-action="refresh" data-chart="types">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn-icon" data-chart-action="export" data-chart="types">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="documentTypesChart"></canvas>
                        </div>
                    </div>

                    <!-- Processing Status Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>وضعیت پردازش</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" data-chart-action="refresh" data-chart="status">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn-icon" data-chart-action="export" data-chart="status">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="processingStatusChart"></canvas>
                        </div>
                    </div>

                    <!-- System Performance Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>عملکرد سیستم</h3>
                            <div class="chart-actions">
                                <select class="form-select" id="performance-metric">
                                    <option value="cpu">CPU</option>
                                    <option value="memory" selected>حافظه</option>
                                    <option value="disk">دیسک</option>
                                    <option value="network">شبکه</option>
                                </select>
                                <button class="btn-icon" data-chart-action="refresh" data-chart="performance">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="btn-icon" data-chart-action="export" data-chart="performance">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-content">
                            <canvas id="systemPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Detailed Analytics -->
            <section class="detailed-analytics">
                <div class="analytics-tabs">
                    <button class="tab-btn active" data-tab="usage">استفاده</button>
                    <button class="tab-btn" data-tab="performance">عملکرد</button>
                    <button class="tab-btn" data-tab="errors">خطاها</button>
                    <button class="tab-btn" data-tab="users">کاربران</button>
                </div>

                <div class="tab-content">
                    <!-- Usage Tab -->
                    <div class="tab-pane active" id="usage-tab">
                        <div class="usage-metrics">
                            <div class="metric-card">
                                <h4>آپلود فایل</h4>
                                <div class="metric-value">2,847 فایل</div>
                                <div class="metric-change positive">+15% نسبت به ماه گذشته</div>
                            </div>
                            <div class="metric-card">
                                <h4>جستجو</h4>
                                <div class="metric-value">12,456 جستجو</div>
                                <div class="metric-change positive">+23% نسبت به ماه گذشته</div>
                            </div>
                            <div class="metric-card">
                                <h4>دانلود</h4>
                                <div class="metric-value">8,923 دانلود</div>
                                <div class="metric-change positive">+8% نسبت به ماه گذشته</div>
                            </div>
                            <div class="metric-card">
                                <h4>زمان استفاده</h4>
                                <div class="metric-value">156 ساعت</div>
                                <div class="metric-change positive">+12% نسبت به ماه گذشته</div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Tab -->
                    <div class="tab-pane" id="performance-tab">
                        <div class="performance-metrics">
                            <div class="metric-card">
                                <h4>زمان پاسخ</h4>
                                <div class="metric-value">245ms</div>
                                <div class="metric-change negative">+15ms نسبت به هفته گذشته</div>
                            </div>
                            <div class="metric-card">
                                <h4>دقت OCR</h4>
                                <div class="metric-value">94.2%</div>
                                <div class="metric-change positive">+1.8% نسبت به ماه گذشته</div>
                            </div>
                            <div class="metric-card">
                                <h4>موفقیت آپلود</h4>
                                <div class="metric-value">99.1%</div>
                                <div class="metric-change positive">+0.3% نسبت به ماه گذشته</div>
                            </div>
                            <div class="metric-card">
                                <h4>در دسترس بودن</h4>
                                <div class="metric-value">99.9%</div>
                                <div class="metric-change neutral">بدون تغییر</div>
                            </div>
                        </div>
                    </div>

                    <!-- Errors Tab -->
                    <div class="tab-pane" id="errors-tab">
                        <div class="errors-list">
                            <div class="error-item">
                                <div class="error-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="error-content">
                                    <div class="error-title">خطا در پردازش فایل</div>
                                    <div class="error-details">فایل PDF آسیب‌دیده - 15 مورد</div>
                                    <div class="error-time">2 ساعت پیش</div>
                                </div>
                                <div class="error-actions">
                                    <button class="btn btn-sm btn-secondary">مشاهده جزئیات</button>
                                </div>
                            </div>
                            <div class="error-item">
                                <div class="error-icon">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                                <div class="error-content">
                                    <div class="error-title">خطا در اتصال به سرور</div>
                                    <div class="error-details">اتصال شبکه قطع - 3 مورد</div>
                                    <div class="error-time">1 روز پیش</div>
                                </div>
                                <div class="error-actions">
                                    <button class="btn btn-sm btn-secondary">مشاهده جزئیات</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Users Tab -->
                    <div class="tab-pane" id="users-tab">
                        <div class="users-metrics">
                            <div class="metric-card">
                                <h4>کاربران جدید</h4>
                                <div class="metric-value">23 کاربر</div>
                                <div class="metric-change positive">+5 نسبت به ماه گذشته</div>
                            </div>
                            <div class="metric-card">
                                <h4>کاربران فعال</h4>
                                <div class="metric-value">156 کاربر</div>
                                <div class="metric-change positive">+12 نسبت به ماه گذشته</div>
                            </div>
                            <div class="metric-card">
                                <h4>میانگین جلسه</h4>
                                <div class="metric-value">45 دقیقه</div>
                                <div class="metric-change positive">+8 دقیقه نسبت به ماه گذشته</div>
                            </div>
                            <div class="metric-card">
                                <h4>نرخ بازگشت</h4>
                                <div class="metric-value">78%</div>
                                <div class="metric-change positive">+5% نسبت به ماه گذشته</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section class="reports-section">
                <div class="reports-header">
                    <h3>گزارش‌های آماده</h3>
                    <button class="btn btn-primary" id="generate-report-btn">
                        <i class="fas fa-plus"></i>
                        ایجاد گزارش جدید
                    </button>
                </div>
                <div class="reports-grid">
                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="report-content">
                            <h4>گزارش ماهانه اسناد</h4>
                            <p>خلاصه‌ای از فعالیت‌های ماه گذشته</p>
                            <div class="report-meta">
                                <span>آخرین بروزرسانی: 2 ساعت پیش</span>
                            </div>
                        </div>
                        <div class="report-actions">
                            <button class="btn btn-sm btn-secondary">مشاهده</button>
                            <button class="btn btn-sm btn-primary">دانلود</button>
                        </div>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="report-content">
                            <h4>گزارش عملکرد سیستم</h4>
                            <p>تحلیل عملکرد و بهینه‌سازی</p>
                            <div class="report-meta">
                                <span>آخرین بروزرسانی: 1 روز پیش</span>
                            </div>
                        </div>
                        <div class="report-actions">
                            <button class="btn btn-sm btn-secondary">مشاهده</button>
                            <button class="btn btn-sm btn-primary">دانلود</button>
                        </div>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="report-content">
                            <h4>گزارش کاربران</h4>
                            <p>تحلیل رفتار و فعالیت کاربران</p>
                            <div class="report-meta">
                                <span>آخرین بروزرسانی: 3 روز پیش</span>
                            </div>
                        </div>
                        <div class="report-actions">
                            <button class="btn btn-sm btn-secondary">مشاهده</button>
                            <button class="btn btn-sm btn-primary">دانلود</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Notification Panel -->
    <div id="notification-panel" class="notification-panel hidden">
        <div class="notification-header">
            <h3>اعلان‌ها</h3>
            <button class="close-btn" id="close-notification-panel">×</button>
        </div>
        <div class="notification-list" id="notification-list"></div>
        <div class="notification-footer">
            <button class="btn btn-secondary" id="mark-all-read">علامت‌گذاری همه</button>
            <button class="btn btn-danger" id="clear-all-notifications">پاک کردن همه</button>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay hidden"></div>

    <!-- Generate Report Modal -->
    <div id="generate-report-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ایجاد گزارش جدید</h3>
                <button class="close-btn" id="close-report-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="report-type">نوع گزارش:</label>
                    <select id="report-type" class="form-select">
                        <option value="monthly">گزارش ماهانه</option>
                        <option value="quarterly">گزارش فصلی</option>
                        <option value="yearly">گزارش سالانه</option>
                        <option value="custom">گزارش سفارشی</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="report-period">بازه زمانی:</label>
                    <select id="report-period" class="form-select">
                        <option value="last-month">ماه گذشته</option>
                        <option value="last-quarter">فصل گذشته</option>
                        <option value="last-year">سال گذشته</option>
                        <option value="custom">سفارشی</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="report-format">فرمت گزارش:</label>
                    <select id="report-format" class="form-select">
                        <option value="pdf">PDF</option>
                        <option value="excel">Excel</option>
                        <option value="csv">CSV</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-report-btn">انصراف</button>
                <button class="btn btn-primary" id="create-report-btn">
                    <i class="fas fa-plus"></i>
                    ایجاد گزارش
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/core.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/state-manager.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/document-manager.js"></script>
    <script src="js/file-handler.js"></script>
    <script src="js/search-engine.js"></script>
    <script src="js/chart-manager.js"></script>

    <!-- Initialize Analytics Page -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing Analytics Page...');

            // Initialize all managers
            const managers = {
                core: window.dashboardCore,
                api: window.apiClient,
                state: window.stateManager,
                navigation: window.navigationManager,
                notifications: window.notificationManager,
                documents: window.documentManager,
                files: window.fileHandler,
                search: window.searchEngine,
                charts: window.chartManager
            };

            // Set up cross-component communication
            managers.core.broadcast('analytics:initialized', { managers });

            // Initialize analytics page functionality
            initializeAnalyticsPage();

            console.log('✅ Analytics page initialized successfully');
        });

        function initializeAnalyticsPage() {
            // Load analytics data
            loadAnalyticsData();

            // Initialize charts
            initializeCharts();

            // Set up tabs
            setupTabs();

            // Set up event listeners
            setupAnalyticsEventListeners();

            // Set up real-time updates
            setupRealTimeUpdates();
        }

        function loadAnalyticsData() {
            // Load overview metrics
            loadOverviewMetrics();

            // Load detailed analytics
            loadDetailedAnalytics();

            // Load reports
            loadReports();
        }

        function loadOverviewMetrics() {
            // Mock data - in real app, this would come from API
            const metrics = {
                totalDocuments: 1234,
                processingRate: 98.5,
                avgProcessingTime: 2.3,
                activeUsers: 45
            };

            document.getElementById('total-documents').textContent = metrics.totalDocuments.toLocaleString('fa-IR');
            document.getElementById('processing-rate').textContent = metrics.processingRate + '%';
            document.getElementById('avg-processing-time').textContent = metrics.avgProcessingTime;
            document.getElementById('active-users').textContent = metrics.activeUsers;
        }

        function loadDetailedAnalytics() {
            // This would load detailed analytics data
            console.log('Loading detailed analytics...');
        }

        function loadReports() {
            // This would load available reports
            console.log('Loading reports...');
        }

        function initializeCharts() {
            if (window.chartManager) {
                // Initialize document trends chart
                window.chartManager.createChart('documentTrends', 'documentTrendsChart');
                
                // Initialize document types chart
                window.chartManager.createChart('documentTypes', 'documentTypesChart');
                
                // Initialize processing status chart
                window.chartManager.createChart('processingStatus', 'processingStatusChart');
                
                // Initialize system performance chart
                window.chartManager.createChart('systemPerformance', 'systemPerformanceChart');
            } else {
                // Fallback chart initialization
                initializeFallbackCharts();
            }
        }

        function initializeFallbackCharts() {
            // Mock chart data
            const trendsData = {
                labels: ['فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور'],
                datasets: [{
                    label: 'اسناد آپلود شده',
                    data: [65, 78, 90, 85, 95, 110],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4
                }]
            };

            const typesData = {
                labels: ['PDF', 'Word', 'تصویر', 'سایر'],
                datasets: [{
                    data: [45, 25, 20, 10],
                    backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444']
                }]
            };

            const statusData = {
                labels: ['تکمیل شده', 'در حال پردازش', 'در انتظار', 'خطا'],
                datasets: [{
                    data: [75, 15, 8, 2],
                    backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444']
                }]
            };

            const performanceData = {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                datasets: [{
                    label: 'استفاده از حافظه (%)',
                    data: [45, 52, 48, 65, 58, 62],
                    borderColor: '#06b6d4',
                    backgroundColor: 'rgba(6, 182, 212, 0.1)',
                    tension: 0.4
                }]
            };

            // Create charts using Chart.js
            if (typeof Chart !== 'undefined') {
                new Chart(document.getElementById('documentTrendsChart'), {
                    type: 'line',
                    data: trendsData,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        }
                    }
                });

                new Chart(document.getElementById('documentTypesChart'), {
                    type: 'doughnut',
                    data: typesData,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            }
                        }
                    }
                });

                new Chart(document.getElementById('processingStatusChart'), {
                    type: 'doughnut',
                    data: statusData,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            }
                        }
                    }
                });

                new Chart(document.getElementById('systemPerformanceChart'), {
                    type: 'line',
                    data: performanceData,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        }
                    }
                });
            }
        }

        function setupTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.dataset.tab;
                    
                    // Remove active class from all buttons and panes
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanes.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding pane
                    btn.classList.add('active');
                    document.getElementById(`${targetTab}-tab`).classList.add('active');
                });
            });
        }

        function setupAnalyticsEventListeners() {
            // Refresh analytics button
            const refreshBtn = document.getElementById('refresh-analytics-btn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    refreshAnalytics();
                });
            }

            // Export report button
            const exportBtn = document.getElementById('export-report-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    exportAnalyticsReport();
                });
            }

            // Generate report button
            const generateBtn = document.getElementById('generate-report-btn');
            if (generateBtn) {
                generateBtn.addEventListener('click', () => {
                    showGenerateReportModal();
                });
            }

            // Chart action buttons
            document.addEventListener('click', (e) => {
                if (e.target.closest('[data-chart-action]')) {
                    const action = e.target.closest('[data-chart-action]').dataset.chartAction;
                    const chart = e.target.closest('[data-chart-action]').dataset.chart;
                    
                    if (action === 'refresh') {
                        refreshChart(chart);
                    } else if (action === 'export') {
                        exportChart(chart);
                    }
                }
            });

            // Period and metric selectors
            const trendPeriod = document.getElementById('trend-period');
            if (trendPeriod) {
                trendPeriod.addEventListener('change', () => {
                    updateTrendChart();
                });
            }

            const performanceMetric = document.getElementById('performance-metric');
            if (performanceMetric) {
                performanceMetric.addEventListener('change', () => {
                    updatePerformanceChart();
                });
            }

            // Mobile menu toggle
            const mobileToggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');

            if (mobileToggle && sidebar) {
                mobileToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('open');
                    overlay.classList.toggle('hidden');
                });
            }

            if (overlay) {
                overlay.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    overlay.classList.add('hidden');
                });
            }

            // Notification panel
            const notificationBell = document.getElementById('notification-bell');
            const notificationPanel = document.getElementById('notification-panel');
            const closePanel = document.getElementById('close-notification-panel');

            if (notificationBell && notificationPanel) {
                notificationBell.addEventListener('click', () => {
                    notificationPanel.classList.toggle('hidden');
                });
            }

            if (closePanel && notificationPanel) {
                closePanel.addEventListener('click', () => {
                    notificationPanel.classList.add('hidden');
                });
            }

            // Generate report modal
            const reportModal = document.getElementById('generate-report-modal');
            const closeReportBtn = document.getElementById('close-report-modal');
            const cancelReportBtn = document.getElementById('cancel-report-btn');
            const createReportBtn = document.getElementById('create-report-btn');

            if (closeReportBtn && reportModal) {
                closeReportBtn.addEventListener('click', () => {
                    reportModal.classList.add('hidden');
                });
            }

            if (cancelReportBtn && reportModal) {
                cancelReportBtn.addEventListener('click', () => {
                    reportModal.classList.add('hidden');
                });
            }

            if (createReportBtn && reportModal) {
                createReportBtn.addEventListener('click', () => {
                    createReport();
                });
            }

            if (reportModal) {
                reportModal.addEventListener('click', (e) => {
                    if (e.target === reportModal) {
                        reportModal.classList.add('hidden');
                    }
                });
            }
        }

        function refreshAnalytics() {
            showLoadingState();
            
            setTimeout(() => {
                loadAnalyticsData();
                hideLoadingState();
                showSuccess('بروزرسانی شد', 'داده‌های تحلیل با موفقیت بروزرسانی شد');
            }, 2000);
        }

        function exportAnalyticsReport() {
            showLoadingState();
            
            setTimeout(() => {
                hideLoadingState();
                showSuccess('صادرات موفق', 'گزارش تحلیل با موفقیت صادر شد');
            }, 1500);
        }

        function refreshChart(chartName) {
            console.log(`Refreshing chart: ${chartName}`);
            showSuccess('بروزرسانی شد', `نمودار ${chartName} بروزرسانی شد`);
        }

        function exportChart(chartName) {
            console.log(`Exporting chart: ${chartName}`);
            showSuccess('صادرات موفق', `نمودار ${chartName} با موفقیت صادر شد`);
        }

        function updateTrendChart() {
            const period = document.getElementById('trend-period').value;
            console.log(`Updating trend chart for period: ${period}`);
            // In real app, this would fetch new data and update the chart
        }

        function updatePerformanceChart() {
            const metric = document.getElementById('performance-metric').value;
            console.log(`Updating performance chart for metric: ${metric}`);
            // In real app, this would fetch new data and update the chart
        }

        function showGenerateReportModal() {
            const modal = document.getElementById('generate-report-modal');
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        function createReport() {
            const reportType = document.getElementById('report-type').value;
            const reportPeriod = document.getElementById('report-period').value;
            const reportFormat = document.getElementById('report-format').value;

            console.log(`Creating report: ${reportType}, ${reportPeriod}, ${reportFormat}`);

            // Close modal
            const modal = document.getElementById('generate-report-modal');
            if (modal) {
                modal.classList.add('hidden');
            }

            // Show success message
            showSuccess('گزارش ایجاد شد', 'گزارش جدید با موفقیت ایجاد شد و در حال آماده‌سازی است');
        }

        function setupRealTimeUpdates() {
            // Set up periodic updates every 30 seconds
            setInterval(() => {
                loadOverviewMetrics();
            }, 30000);
        }

        function showLoadingState() {
            // Add loading indicator
            const refreshBtn = document.getElementById('refresh-analytics-btn');
            if (refreshBtn) {
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> در حال بروزرسانی...';
                refreshBtn.disabled = true;
            }
        }

        function hideLoadingState() {
            // Remove loading indicator
            const refreshBtn = document.getElementById('refresh-analytics-btn');
            if (refreshBtn) {
                refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> بروزرسانی';
                refreshBtn.disabled = false;
            }
        }

        function showSuccess(title, message) {
            if (window.notificationManager) {
                window.notificationManager.showSuccess(title, message);
            } else {
                alert(`${title}: ${message}`);
            }
        }

        function showError(title, message) {
            if (window.notificationManager) {
                window.notificationManager.showError(title, message);
            } else {
                alert(`${title}: ${message}`);
            }
        }
    </script>
</body>
</html>