<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ | Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    
    <!-- Preconnect for better performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- ÙÙˆÙ†Øª Ùˆ Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <span class="logo-text">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø­Ù‚ÙˆÙ‚ÛŒ</span>
                </a>
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="main-nav">
                <div class="nav-section">
                    <h4 class="nav-title">Ø§ØµÙ„ÛŒ</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link" data-nav="dashboard">
                                <span class="nav-icon"><i class="fas fa-tachometer-alt"></i></span>
                                <span>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="documents.html" class="nav-link" data-nav="documents">
                                <span class="nav-icon"><i class="fas fa-file-alt"></i></span>
                                <span>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ù†Ø§Ø¯</span>
                                <span class="nav-badge" data-badge="documents">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="upload.html" class="nav-link" data-nav="upload">
                                <span class="nav-icon"><i class="fas fa-cloud-upload-alt"></i></span>
                                <span>Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="search.html" class="nav-link active" data-nav="search">
                                <span class="nav-icon"><i class="fas fa-search"></i></span>
                                <span>Ø¬Ø³ØªØ¬Ùˆ</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="analytics.html" class="nav-link" data-nav="analytics">
                                <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                                <span>ØªØ­Ù„ÛŒÙ„ Ùˆ Ú¯Ø²Ø§Ø±Ø´</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h4 class="nav-title">Ø³ÛŒØ³ØªÙ…</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="system-health.html" class="nav-link" data-nav="systemHealth">
                                <span class="nav-icon"><i class="fas fa-heartbeat"></i></span>
                                <span>ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="settings.html" class="nav-link" data-nav="settings">
                                <span class="nav-icon"><i class="fas fa-cog"></i></span>
                                <span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 class="header-title">Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>
                <div class="header-actions">
                    <button class="btn-icon" id="user-menu-btn">
                        <i class="fas fa-user-circle"></i>
                    </button>
                    <button class="btn-icon" id="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-badge">0</span>
                    </button>
                </div>
            </header>

            <!-- Breadcrumbs -->
            <div class="breadcrumb-container" id="breadcrumb-container">
                <a href="index.html" class="breadcrumb-item">
                    <i class="fas fa-home"></i>
                    <span>Ø®Ø§Ù†Ù‡</span>
                </a>
                <i class="fas fa-angle-left mx-2 text-gray-400"></i>
                <span class="breadcrumb-item active" aria-current="page">Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</span>
            </div>

            <!-- Search Section -->
            <section class="search-section">
                <!-- Main Search Bar -->
                <div class="main-search-container">
                    <div class="search-input-container">
                        <input type="text" 
                               placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø§Ø³Ù†Ø§Ø¯ØŒ Ù…ØªÙ†ØŒ Ùˆ Ù…ØªØ§Ø¯ÛŒØªØ§..." 
                               class="form-input main-search-input" 
                               id="main-search-input">
                        <button class="btn btn-primary search-btn" id="search-btn">
                            <i class="fas fa-search"></i>
                            Ø¬Ø³ØªØ¬Ùˆ
                        </button>
                    </div>
                    <button class="btn btn-secondary" id="advanced-search-toggle">
                        <i class="fas fa-sliders-h"></i>
                        Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
                    </button>
                </div>

                <!-- Advanced Search Panel -->
                <div class="advanced-search-panel" id="advanced-search-panel" style="display: none;">
                    <div class="advanced-filters">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="file-type-filter">Ù†ÙˆØ¹ ÙØ§ÛŒÙ„:</label>
                                <select id="file-type-filter" class="form-select">
                                    <option value="">Ù‡Ù…Ù‡ Ø§Ù†ÙˆØ§Ø¹</option>
                                    <option value="pdf">PDF</option>
                                    <option value="doc">Word</option>
                                    <option value="image">ØªØµÙˆÛŒØ±</option>
                                    <option value="other">Ø³Ø§ÛŒØ±</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="date-range-filter">Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ:</label>
                                <select id="date-range-filter" class="form-select">
                                    <option value="">Ù‡Ù…Ù‡ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§</option>
                                    <option value="today">Ø§Ù…Ø±ÙˆØ²</option>
                                    <option value="week">Ø§ÛŒÙ† Ù‡ÙØªÙ‡</option>
                                    <option value="month">Ø§ÛŒÙ† Ù…Ø§Ù‡</option>
                                    <option value="year">Ø§ÛŒÙ† Ø³Ø§Ù„</option>
                                    <option value="custom">Ø³ÙØ§Ø±Ø´ÛŒ</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="size-filter">Ø­Ø¬Ù… ÙØ§ÛŒÙ„:</label>
                                <select id="size-filter" class="form-select">
                                    <option value="">Ù‡Ù…Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÙ‡Ø§</option>
                                    <option value="small">Ú©ÙˆÚ†Ú© (Ú©Ù…ØªØ± Ø§Ø² 1MB)</option>
                                    <option value="medium">Ù…ØªÙˆØ³Ø· (1-10MB)</option>
                                    <option value="large">Ø¨Ø²Ø±Ú¯ (Ø¨ÛŒØ´ Ø§Ø² 10MB)</option>
                                </select>
                            </div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="status-filter">ÙˆØ¶Ø¹ÛŒØª:</label>
                                <select id="status-filter" class="form-select">
                                    <option value="">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                                    <option value="completed">ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</option>
                                    <option value="processing">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´</option>
                                    <option value="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
                                    <option value="error">Ø®Ø·Ø§</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="confidence-filter">Ø¯Ù‚Øª OCR:</label>
                                <select id="confidence-filter" class="form-select">
                                    <option value="">Ù‡Ù…Ù‡ Ø³Ø·ÙˆØ­</option>
                                    <option value="high">Ø¨Ø§Ù„Ø§ (90%+)</option>
                                    <option value="medium">Ù…ØªÙˆØ³Ø· (70-90%)</option>
                                    <option value="low">Ù¾Ø§ÛŒÛŒÙ† (Ú©Ù…ØªØ± Ø§Ø² 70%)</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="sort-filter">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ:</label>
                                <select id="sort-filter" class="form-select">
                                    <option value="relevance">Ù…Ø±ØªØ¨Ø·â€ŒØªØ±ÛŒÙ†</option>
                                    <option value="date-desc">ØªØ§Ø±ÛŒØ® (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†)</option>
                                    <option value="date-asc">ØªØ§Ø±ÛŒØ® (Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ±ÛŒÙ†)</option>
                                    <option value="name-asc">Ù†Ø§Ù… (Ø§Ù„Ù-ÛŒ)</option>
                                    <option value="name-desc">Ù†Ø§Ù… (ÛŒ-Ø§Ù„Ù)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Suggestions -->
                <div class="search-suggestions" id="search-suggestions" style="display: none;">
                    <!-- Suggestions will be populated dynamically -->
                </div>
            </section>

            <!-- Search Results -->
            <section class="search-results-section" id="search-results-section" style="display: none;">
                <div class="results-header">
                    <div class="results-info">
                        <h3>Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ</h3>
                        <span class="results-count" id="results-count">0 Ù†ØªÛŒØ¬Ù‡</span>
                    </div>
                    <div class="results-actions">
                        <button class="btn btn-secondary" id="export-results-btn">
                            <i class="fas fa-download"></i>
                            ØµØ§Ø¯Ø±Ø§Øª Ù†ØªØ§ÛŒØ¬
                        </button>
                        <button class="btn btn-primary" id="save-search-btn">
                            <i class="fas fa-bookmark"></i>
                            Ø°Ø®ÛŒØ±Ù‡ Ø¬Ø³ØªØ¬Ùˆ
                        </button>
                    </div>
                </div>

                <div class="results-container" id="results-container">
                    <!-- Search results will be populated here -->
                </div>

                <!-- Loading State -->
                <div class="loading-state" id="search-loading-state">
                    <div class="loading-spinner"></div>
                    <p>Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ...</p>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="search-empty-state" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3>Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
                    <p>Ù„Ø·ÙØ§Ù‹ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯</p>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="search-pagination">
                    <!-- Pagination will be generated dynamically -->
                </div>
            </section>

            <!-- Search History -->
            <section class="search-history-section">
                <div class="history-header">
                    <h3>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¬Ø³ØªØ¬Ùˆ</h3>
                    <button class="btn btn-secondary" id="clear-history-btn">
                        <i class="fas fa-trash"></i>
                        Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡
                    </button>
                </div>
                <div class="history-list" id="search-history-list">
                    <!-- Search history will be populated here -->
                </div>
            </section>

            <!-- Search Analytics -->
            <section class="search-analytics-section">
                <div class="analytics-header">
                    <h3>Ø¢Ù…Ø§Ø± Ø¬Ø³ØªØ¬Ùˆ</h3>
                </div>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="analytics-value" id="total-searches">0</div>
                        <div class="analytics-label">Ú©Ù„ Ø¬Ø³ØªØ¬ÙˆÙ‡Ø§</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="analytics-value" id="total-results">0</div>
                        <div class="analytics-label">Ú©Ù„ Ù†ØªØ§ÛŒØ¬</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="analytics-value" id="avg-search-time">0</div>
                        <div class="analytics-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† (Ø«Ø§Ù†ÛŒÙ‡)</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="analytics-value" id="success-rate">0%</div>
                        <div class="analytics-label">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Notification Panel -->
    <div id="notification-panel" class="notification-panel hidden">
        <div class="notification-header">
            <h3>Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</h3>
            <button class="close-btn" id="close-notification-panel">Ã—</button>
        </div>
        <div class="notification-list" id="notification-list"></div>
        <div class="notification-footer">
            <button class="btn btn-secondary" id="mark-all-read">Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡</button>
            <button class="btn btn-danger" id="clear-all-notifications">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡</button>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay hidden"></div>

    <!-- Document Preview Modal -->
    <div id="document-preview-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="preview-title">Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø³Ù†Ø¯</h3>
                <button class="close-btn" id="close-preview-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="preview-content">
                    <!-- Preview content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="download-preview-btn">
                    <i class="fas fa-download"></i>
                    Ø¯Ø§Ù†Ù„ÙˆØ¯
                </button>
                <button class="btn btn-primary" id="edit-preview-btn">
                    <i class="fas fa-edit"></i>
                    ÙˆÛŒØ±Ø§ÛŒØ´
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/core.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/state-manager.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/document-manager.js"></script>
    <script src="js/file-handler.js"></script>
    <script src="js/search-engine.js"></script>
    <script src="js/chart-manager.js"></script>

    <!-- Initialize Search Page -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Initializing Search Page...');

            // Initialize all managers
            const managers = {
                core: window.dashboardCore,
                api: window.apiClient,
                state: window.stateManager,
                navigation: window.navigationManager,
                notifications: window.notificationManager,
                documents: window.documentManager,
                files: window.fileHandler,
                search: window.searchEngine,
                charts: window.chartManager
            };

            // Set up cross-component communication
            managers.core.broadcast('search:initialized', { managers });

            // Initialize search page functionality
            initializeSearchPage();

            console.log('âœ… Search page initialized successfully');
        });

        function initializeSearchPage() {
            // Set up search functionality
            setupSearchFunctionality();

            // Set up advanced search
            setupAdvancedSearch();

            // Set up search history
            loadSearchHistory();

            // Set up search analytics
            loadSearchAnalytics();

            // Set up event listeners
            setupSearchEventListeners();
        }

        function setupSearchFunctionality() {
            const searchInput = document.getElementById('main-search-input');
            const searchBtn = document.getElementById('search-btn');
            const suggestionsContainer = document.getElementById('search-suggestions');

            if (searchInput) {
                searchInput.addEventListener('input', debounce((e) => {
                    const query = e.target.value.trim();
                    if (query.length > 2) {
                        showSearchSuggestions(query);
                    } else {
                        hideSearchSuggestions();
                    }
                }, 300));

                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }

            if (searchBtn) {
                searchBtn.addEventListener('click', performSearch);
            }
        }

        function setupAdvancedSearch() {
            const advancedToggle = document.getElementById('advanced-search-toggle');
            const advancedPanel = document.getElementById('advanced-search-panel');

            if (advancedToggle && advancedPanel) {
                advancedToggle.addEventListener('click', () => {
                    const isVisible = advancedPanel.style.display !== 'none';
                    advancedPanel.style.display = isVisible ? 'none' : 'block';
                    advancedToggle.innerHTML = isVisible ? 
                        '<i class="fas fa-sliders-h"></i> Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡' :
                        '<i class="fas fa-times"></i> Ø¨Ø³ØªÙ†';
                });
            }

            // Set up filter change listeners
            const filters = ['file-type-filter', 'date-range-filter', 'size-filter', 'status-filter', 'confidence-filter', 'sort-filter'];
            filters.forEach(filterId => {
                const filter = document.getElementById(filterId);
                if (filter) {
                    filter.addEventListener('change', () => {
                        if (document.getElementById('main-search-input').value.trim()) {
                            performSearch();
                        }
                    });
                }
            });
        }

        function showSearchSuggestions(query) {
            const suggestionsContainer = document.getElementById('search-suggestions');
            if (!suggestionsContainer) return;

            // Mock suggestions - in real app, these would come from API
            const suggestions = [
                `${query} Ø¯Ø± Ø§Ø³Ù†Ø§Ø¯ Ø­Ù‚ÙˆÙ‚ÛŒ`,
                `${query} Ø¯Ø± Ù‚ÙˆØ§Ù†ÛŒÙ†`,
                `${query} Ø¯Ø± Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§`,
                `${query} Ø¯Ø± Ø§Ø­Ú©Ø§Ù…`
            ];

            suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                <div class="suggestion-item" onclick="selectSuggestion('${suggestion}')">
                    <i class="fas fa-search"></i>
                    <span>${suggestion}</span>
                </div>
            `).join('');

            suggestionsContainer.style.display = 'block';
        }

        function hideSearchSuggestions() {
            const suggestionsContainer = document.getElementById('search-suggestions');
            if (suggestionsContainer) {
                suggestionsContainer.style.display = 'none';
            }
        }

        function selectSuggestion(suggestion) {
            const searchInput = document.getElementById('main-search-input');
            if (searchInput) {
                searchInput.value = suggestion;
                hideSearchSuggestions();
                performSearch();
            }
        }

        function performSearch() {
            const searchInput = document.getElementById('main-search-input');
            const query = searchInput ? searchInput.value.trim() : '';

            if (!query) {
                showError('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ', 'Ù„Ø·ÙØ§Ù‹ Ø¹Ø¨Ø§Ø±Øª Ø¬Ø³ØªØ¬Ùˆ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }

            // Get advanced filters
            const filters = {
                fileType: document.getElementById('file-type-filter')?.value || '',
                dateRange: document.getElementById('date-range-filter')?.value || '',
                size: document.getElementById('size-filter')?.value || '',
                status: document.getElementById('status-filter')?.value || '',
                confidence: document.getElementById('confidence-filter')?.value || '',
                sort: document.getElementById('sort-filter')?.value || 'relevance'
            };

            showSearchLoading();
            hideSearchSuggestions();

            if (window.searchEngine) {
                window.searchEngine.performSearch(query, filters);
            } else {
                // Fallback search simulation
                simulateSearch(query, filters);
            }

            // Add to search history
            addToSearchHistory(query);
        }

        function simulateSearch(query, filters) {
            setTimeout(() => {
                hideSearchLoading();
                
                // Mock search results
                const results = [
                    {
                        id: 1,
                        title: `Ø³Ù†Ø¯ Ø­Ù‚ÙˆÙ‚ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ${query}`,
                        filename: `document_${query}_1.pdf`,
                        type: 'pdf',
                        size: 2048576,
                        date: new Date().toISOString(),
                        status: 'completed',
                        confidence: 0.95,
                        excerpt: `Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø´Ø§Ù…Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ${query} Ø§Ø³Øª Ú©Ù‡ Ø¯Ø± ØªØ§Ø±ÛŒØ®...`,
                        matches: [query]
                    },
                    {
                        id: 2,
                        title: `Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ ${query}`,
                        filename: `contract_${query}_2.doc`,
                        type: 'doc',
                        size: 1048576,
                        date: new Date(Date.now() - 86400000).toISOString(),
                        status: 'completed',
                        confidence: 0.88,
                        excerpt: `Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ${query} Ú©Ù‡ Ø¯Ø± Ø³Ø§Ù„...`,
                        matches: [query]
                    }
                ];

                displaySearchResults(results);
            }, 1500);
        }

        function showSearchLoading() {
            const loadingState = document.getElementById('search-loading-state');
            const resultsSection = document.getElementById('search-results-section');
            const emptyState = document.getElementById('search-empty-state');

            if (loadingState) loadingState.style.display = 'flex';
            if (resultsSection) resultsSection.style.display = 'none';
            if (emptyState) emptyState.style.display = 'none';
        }

        function hideSearchLoading() {
            const loadingState = document.getElementById('search-loading-state');
            if (loadingState) loadingState.style.display = 'none';
        }

        function displaySearchResults(results) {
            const resultsSection = document.getElementById('search-results-section');
            const resultsContainer = document.getElementById('results-container');
            const resultsCount = document.getElementById('results-count');
            const emptyState = document.getElementById('search-empty-state');

            if (results.length === 0) {
                if (emptyState) emptyState.style.display = 'flex';
                if (resultsSection) resultsSection.style.display = 'none';
                return;
            }

            if (resultsSection) resultsSection.style.display = 'block';
            if (emptyState) emptyState.style.display = 'none';
            if (resultsCount) resultsCount.textContent = `${results.length} Ù†ØªÛŒØ¬Ù‡`;

            if (resultsContainer) {
                resultsContainer.innerHTML = results.map(result => `
                    <div class="search-result" data-result-id="${result.id}">
                        <div class="result-icon">
                            <i class="fas ${getFileIcon(result.type)}"></i>
                        </div>
                        <div class="result-content">
                            <div class="result-title">${result.title}</div>
                            <div class="result-meta">
                                <span class="result-filename">${result.filename}</span>
                                <span class="result-size">${formatFileSize(result.size)}</span>
                                <span class="result-date">${formatDate(result.date)}</span>
                                <span class="result-confidence">Ø¯Ù‚Øª: ${Math.round(result.confidence * 100)}%</span>
                            </div>
                            <div class="result-excerpt">${highlightQuery(result.excerpt, document.getElementById('main-search-input').value)}</div>
                        </div>
                        <div class="result-actions">
                            <button class="btn-icon" onclick="previewResult(${result.id})" title="Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" onclick="downloadResult(${result.id})" title="Ø¯Ø§Ù†Ù„ÙˆØ¯">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function highlightQuery(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        function getFileIcon(type) {
            const icons = {
                pdf: 'fa-file-pdf',
                doc: 'fa-file-word',
                image: 'fa-file-image',
                other: 'fa-file'
            };
            return icons[type] || 'fa-file';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Ø¨Ø§ÛŒØª';
            const k = 1024;
            const sizes = ['Ø¨Ø§ÛŒØª', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fa-IR');
        }

        function addToSearchHistory(query) {
            const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            const newHistory = [query, ...history.filter(item => item !== query)].slice(0, 10);
            localStorage.setItem('searchHistory', JSON.stringify(newHistory));
            loadSearchHistory();
        }

        function loadSearchHistory() {
            const historyList = document.getElementById('search-history-list');
            const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');

            if (historyList) {
                historyList.innerHTML = history.map(query => `
                    <div class="history-item" onclick="selectHistoryItem('${query}')">
                        <i class="fas fa-history"></i>
                        <span>${query}</span>
                        <button class="btn-icon" onclick="removeHistoryItem('${query}', event)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `).join('');
            }
        }

        function selectHistoryItem(query) {
            const searchInput = document.getElementById('main-search-input');
            if (searchInput) {
                searchInput.value = query;
                performSearch();
            }
        }

        function removeHistoryItem(query, event) {
            event.stopPropagation();
            const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            const newHistory = history.filter(item => item !== query);
            localStorage.setItem('searchHistory', JSON.stringify(newHistory));
            loadSearchHistory();
        }

        function loadSearchAnalytics() {
            // Mock analytics data
            document.getElementById('total-searches').textContent = '1,234';
            document.getElementById('total-results').textContent = '5,678';
            document.getElementById('avg-search-time').textContent = '0.8';
            document.getElementById('success-rate').textContent = '95%';
        }

        function setupSearchEventListeners() {
            // Export results button
            const exportBtn = document.getElementById('export-results-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    if (window.searchEngine) {
                        window.searchEngine.exportSearchResults();
                    } else {
                        showSuccess('ØµØ§Ø¯Ø±Ø§Øª', 'Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØµØ§Ø¯Ø± Ø´Ø¯');
                    }
                });
            }

            // Save search button
            const saveSearchBtn = document.getElementById('save-search-btn');
            if (saveSearchBtn) {
                saveSearchBtn.addEventListener('click', () => {
                    const query = document.getElementById('main-search-input').value.trim();
                    if (query) {
                        const savedSearches = JSON.parse(localStorage.getItem('savedSearches') || '[]');
                        savedSearches.push({
                            query,
                            date: new Date().toISOString(),
                            filters: getCurrentFilters()
                        });
                        localStorage.setItem('savedSearches', JSON.stringify(savedSearches));
                        showSuccess('Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
                    }
                });
            }

            // Clear history button
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            if (clearHistoryBtn) {
                clearHistoryBtn.addEventListener('click', () => {
                    localStorage.removeItem('searchHistory');
                    loadSearchHistory();
                    showSuccess('Ù¾Ø§Ú© Ø´Ø¯', 'ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¬Ø³ØªØ¬Ùˆ Ù¾Ø§Ú© Ø´Ø¯');
                });
            }

            // Mobile menu toggle
            const mobileToggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');

            if (mobileToggle && sidebar) {
                mobileToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('open');
                    overlay.classList.toggle('hidden');
                });
            }

            if (overlay) {
                overlay.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    overlay.classList.add('hidden');
                });
            }

            // Notification panel
            const notificationBell = document.getElementById('notification-bell');
            const notificationPanel = document.getElementById('notification-panel');
            const closePanel = document.getElementById('close-notification-panel');

            if (notificationBell && notificationPanel) {
                notificationBell.addEventListener('click', () => {
                    notificationPanel.classList.toggle('hidden');
                });
            }

            if (closePanel && notificationPanel) {
                closePanel.addEventListener('click', () => {
                    notificationPanel.classList.add('hidden');
                });
            }

            // Document preview modal
            const previewModal = document.getElementById('document-preview-modal');
            const closePreviewBtn = document.getElementById('close-preview-modal');

            if (closePreviewBtn && previewModal) {
                closePreviewBtn.addEventListener('click', () => {
                    previewModal.classList.add('hidden');
                });
            }

            if (previewModal) {
                previewModal.addEventListener('click', (e) => {
                    if (e.target === previewModal) {
                        previewModal.classList.add('hidden');
                    }
                });
            }
        }

        function getCurrentFilters() {
            return {
                fileType: document.getElementById('file-type-filter')?.value || '',
                dateRange: document.getElementById('date-range-filter')?.value || '',
                size: document.getElementById('size-filter')?.value || '',
                status: document.getElementById('status-filter')?.value || '',
                confidence: document.getElementById('confidence-filter')?.value || '',
                sort: document.getElementById('sort-filter')?.value || 'relevance'
            };
        }

        function previewResult(resultId) {
            // Mock preview functionality
            const previewModal = document.getElementById('document-preview-modal');
            const previewTitle = document.getElementById('preview-title');
            const previewContent = document.getElementById('preview-content');

            if (previewTitle) previewTitle.textContent = 'Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø³Ù†Ø¯';
            if (previewContent) {
                previewContent.innerHTML = `
                    <div class="preview-info">
                        <p><strong>Ù†Ø§Ù… ÙØ§ÛŒÙ„:</strong> document_${resultId}.pdf</p>
                        <p><strong>Ù†ÙˆØ¹:</strong> PDF</p>
                        <p><strong>Ø­Ø¬Ù…:</strong> 2.0 MB</p>
                        <p><strong>ØªØ§Ø±ÛŒØ®:</strong> ${new Date().toLocaleDateString('fa-IR')}</p>
                    </div>
                    <div class="preview-text">
                        <p>Ø§ÛŒÙ† ÛŒÚ© Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆÙ†Ù‡ Ø§Ø² Ù…Ø­ØªÙˆØ§ÛŒ Ø³Ù†Ø¯ Ø§Ø³Øª. Ø¯Ø± Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒØŒ Ù…Ø­ØªÙˆØ§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ ÙØ§ÛŒÙ„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.</p>
                    </div>
                `;
            }
            if (previewModal) previewModal.classList.remove('hidden');
        }

        function downloadResult(resultId) {
            showSuccess('Ø¯Ø§Ù†Ù„ÙˆØ¯', 'ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function showSuccess(title, message) {
            if (window.notificationManager) {
                window.notificationManager.showSuccess(title, message);
            } else {
                alert(`${title}: ${message}`);
            }
        }

        function showError(title, message) {
            if (window.notificationManager) {
                window.notificationManager.showError(title, message);
            } else {
                alert(`${title}: ${message}`);
            }
        }

        // Global functions for onclick handlers
        window.selectSuggestion = selectSuggestion;
        window.previewResult = previewResult;
        window.downloadResult = downloadResult;
        window.selectHistoryItem = selectHistoryItem;
        window.removeHistoryItem = removeHistoryItem;
    </script>
</body>
</html>