<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جستجوی پیشرفته | سامانه هوشمند</title>
    
    <!-- Preconnect for better performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- فونت و آیکون‌ها -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <span class="logo-text">داشبورد حقوقی</span>
                </a>
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="main-nav">
                <div class="nav-section">
                    <h4 class="nav-title">اصلی</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link" data-nav="dashboard">
                                <span class="nav-icon"><i class="fas fa-tachometer-alt"></i></span>
                                <span>داشبورد</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="documents.html" class="nav-link" data-nav="documents">
                                <span class="nav-icon"><i class="fas fa-file-alt"></i></span>
                                <span>مدیریت اسناد</span>
                                <span class="nav-badge" data-badge="documents">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="upload.html" class="nav-link" data-nav="upload">
                                <span class="nav-icon"><i class="fas fa-cloud-upload-alt"></i></span>
                                <span>آپلود فایل</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="search.html" class="nav-link active" data-nav="search">
                                <span class="nav-icon"><i class="fas fa-search"></i></span>
                                <span>جستجو</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="analytics.html" class="nav-link" data-nav="analytics">
                                <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                                <span>تحلیل و گزارش</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h4 class="nav-title">سیستم</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="system-health.html" class="nav-link" data-nav="systemHealth">
                                <span class="nav-icon"><i class="fas fa-heartbeat"></i></span>
                                <span>وضعیت سیستم</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="settings.html" class="nav-link" data-nav="settings">
                                <span class="nav-icon"><i class="fas fa-cog"></i></span>
                                <span>تنظیمات</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 class="header-title">جستجوی پیشرفته</h1>
                <div class="header-actions">
                    <button class="btn-icon" id="user-menu-btn">
                        <i class="fas fa-user-circle"></i>
                    </button>
                    <button class="btn-icon" id="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-badge">0</span>
                    </button>
                </div>
            </header>

            <!-- Breadcrumbs -->
            <div class="breadcrumb-container" id="breadcrumb-container">
                <a href="index.html" class="breadcrumb-item">
                    <i class="fas fa-home"></i>
                    <span>خانه</span>
                </a>
                <i class="fas fa-angle-left mx-2 text-gray-400"></i>
                <span class="breadcrumb-item active" aria-current="page">جستجوی پیشرفته</span>
            </div>

            <!-- Search Section -->
            <section class="search-section">
                <!-- Main Search Bar -->
                <div class="main-search-container">
                    <div class="search-input-container">
                        <input type="text" 
                               placeholder="جستجو در اسناد، متن، و متادیتا..." 
                               class="form-input main-search-input" 
                               id="main-search-input">
                        <button class="btn btn-primary search-btn" id="search-btn">
                            <i class="fas fa-search"></i>
                            جستجو
                        </button>
                    </div>
                    <button class="btn btn-secondary" id="advanced-search-toggle">
                        <i class="fas fa-sliders-h"></i>
                        جستجوی پیشرفته
                    </button>
                </div>

                <!-- Advanced Search Panel -->
                <div class="advanced-search-panel" id="advanced-search-panel" style="display: none;">
                    <div class="advanced-filters">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="file-type-filter">نوع فایل:</label>
                                <select id="file-type-filter" class="form-select">
                                    <option value="">همه انواع</option>
                                    <option value="pdf">PDF</option>
                                    <option value="doc">Word</option>
                                    <option value="image">تصویر</option>
                                    <option value="other">سایر</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="date-range-filter">بازه زمانی:</label>
                                <select id="date-range-filter" class="form-select">
                                    <option value="">همه زمان‌ها</option>
                                    <option value="today">امروز</option>
                                    <option value="week">این هفته</option>
                                    <option value="month">این ماه</option>
                                    <option value="year">این سال</option>
                                    <option value="custom">سفارشی</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="size-filter">حجم فایل:</label>
                                <select id="size-filter" class="form-select">
                                    <option value="">همه اندازه‌ها</option>
                                    <option value="small">کوچک (کمتر از 1MB)</option>
                                    <option value="medium">متوسط (1-10MB)</option>
                                    <option value="large">بزرگ (بیش از 10MB)</option>
                                </select>
                            </div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="status-filter">وضعیت:</label>
                                <select id="status-filter" class="form-select">
                                    <option value="">همه وضعیت‌ها</option>
                                    <option value="completed">تکمیل شده</option>
                                    <option value="processing">در حال پردازش</option>
                                    <option value="pending">در انتظار</option>
                                    <option value="error">خطا</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="confidence-filter">دقت OCR:</label>
                                <select id="confidence-filter" class="form-select">
                                    <option value="">همه سطوح</option>
                                    <option value="high">بالا (90%+)</option>
                                    <option value="medium">متوسط (70-90%)</option>
                                    <option value="low">پایین (کمتر از 70%)</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="sort-filter">مرتب‌سازی:</label>
                                <select id="sort-filter" class="form-select">
                                    <option value="relevance">مرتبط‌ترین</option>
                                    <option value="date-desc">تاریخ (جدیدترین)</option>
                                    <option value="date-asc">تاریخ (قدیمی‌ترین)</option>
                                    <option value="name-asc">نام (الف-ی)</option>
                                    <option value="name-desc">نام (ی-الف)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Suggestions -->
                <div class="search-suggestions" id="search-suggestions" style="display: none;">
                    <!-- Suggestions will be populated dynamically -->
                </div>
            </section>

            <!-- Search Results -->
            <section class="search-results-section" id="search-results-section" style="display: none;">
                <div class="results-header">
                    <div class="results-info">
                        <h3>نتایج جستجو</h3>
                        <span class="results-count" id="results-count">0 نتیجه</span>
                    </div>
                    <div class="results-actions">
                        <button class="btn btn-secondary" id="export-results-btn">
                            <i class="fas fa-download"></i>
                            صادرات نتایج
                        </button>
                        <button class="btn btn-primary" id="save-search-btn">
                            <i class="fas fa-bookmark"></i>
                            ذخیره جستجو
                        </button>
                    </div>
                </div>

                <div class="results-container" id="results-container">
                    <!-- Search results will be populated here -->
                </div>

                <!-- Loading State -->
                <div class="loading-state" id="search-loading-state">
                    <div class="loading-spinner"></div>
                    <p>در حال جستجو...</p>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="search-empty-state" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3>نتیجه‌ای یافت نشد</h3>
                    <p>لطفاً کلمات کلیدی دیگری را امتحان کنید یا فیلترهای جستجو را تغییر دهید</p>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="search-pagination">
                    <!-- Pagination will be generated dynamically -->
                </div>
            </section>

            <!-- Search History -->
            <section class="search-history-section">
                <div class="history-header">
                    <h3>تاریخچه جستجو</h3>
                    <button class="btn btn-secondary" id="clear-history-btn">
                        <i class="fas fa-trash"></i>
                        پاک کردن تاریخچه
                    </button>
                </div>
                <div class="history-list" id="search-history-list">
                    <!-- Search history will be populated here -->
                </div>
            </section>

            <!-- Search Analytics -->
            <section class="search-analytics-section">
                <div class="analytics-header">
                    <h3>آمار جستجو</h3>
                </div>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="analytics-value" id="total-searches">0</div>
                        <div class="analytics-label">کل جستجوها</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="analytics-value" id="total-results">0</div>
                        <div class="analytics-label">کل نتایج</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="analytics-value" id="avg-search-time">0</div>
                        <div class="analytics-label">میانگین زمان (ثانیه)</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="analytics-value" id="success-rate">0%</div>
                        <div class="analytics-label">نرخ موفقیت</div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Notification Panel -->
    <div id="notification-panel" class="notification-panel hidden">
        <div class="notification-header">
            <h3>اعلان‌ها</h3>
            <button class="close-btn" id="close-notification-panel">×</button>
        </div>
        <div class="notification-list" id="notification-list"></div>
        <div class="notification-footer">
            <button class="btn btn-secondary" id="mark-all-read">علامت‌گذاری همه</button>
            <button class="btn btn-danger" id="clear-all-notifications">پاک کردن همه</button>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay hidden"></div>

    <!-- Document Preview Modal -->
    <div id="document-preview-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="preview-title">پیش‌نمایش سند</h3>
                <button class="close-btn" id="close-preview-modal">×</button>
            </div>
            <div class="modal-body">
                <div id="preview-content">
                    <!-- Preview content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="download-preview-btn">
                    <i class="fas fa-download"></i>
                    دانلود
                </button>
                <button class="btn btn-primary" id="edit-preview-btn">
                    <i class="fas fa-edit"></i>
                    ویرایش
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/core.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/state-manager.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/document-manager.js"></script>
    <script src="js/file-handler.js"></script>
    <script src="js/search-engine.js"></script>
    <script src="js/chart-manager.js"></script>

    <!-- Initialize Search Page -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing Search Page...');

            // Initialize all managers
            const managers = {
                core: window.dashboardCore,
                api: window.apiClient,
                state: window.stateManager,
                navigation: window.navigationManager,
                notifications: window.notificationManager,
                documents: window.documentManager,
                files: window.fileHandler,
                search: window.searchEngine,
                charts: window.chartManager
            };

            // Set up cross-component communication
            managers.core.broadcast('search:initialized', { managers });

            // Initialize search page functionality
            initializeSearchPage();

            console.log('✅ Search page initialized successfully');
        });

        function initializeSearchPage() {
            // Set up search functionality
            setupSearchFunctionality();

            // Set up advanced search
            setupAdvancedSearch();

            // Set up search history
            loadSearchHistory();

            // Set up search analytics
            loadSearchAnalytics();

            // Set up event listeners
            setupSearchEventListeners();
        }

        function setupSearchFunctionality() {
            const searchInput = document.getElementById('main-search-input');
            const searchBtn = document.getElementById('search-btn');
            const suggestionsContainer = document.getElementById('search-suggestions');

            if (searchInput) {
                searchInput.addEventListener('input', debounce((e) => {
                    const query = e.target.value.trim();
                    if (query.length > 2) {
                        showSearchSuggestions(query);
                    } else {
                        hideSearchSuggestions();
                    }
                }, 300));

                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }

            if (searchBtn) {
                searchBtn.addEventListener('click', performSearch);
            }
        }

        function setupAdvancedSearch() {
            const advancedToggle = document.getElementById('advanced-search-toggle');
            const advancedPanel = document.getElementById('advanced-search-panel');

            if (advancedToggle && advancedPanel) {
                advancedToggle.addEventListener('click', () => {
                    const isVisible = advancedPanel.style.display !== 'none';
                    advancedPanel.style.display = isVisible ? 'none' : 'block';
                    advancedToggle.innerHTML = isVisible ? 
                        '<i class="fas fa-sliders-h"></i> جستجوی پیشرفته' :
                        '<i class="fas fa-times"></i> بستن';
                });
            }

            // Set up filter change listeners
            const filters = ['file-type-filter', 'date-range-filter', 'size-filter', 'status-filter', 'confidence-filter', 'sort-filter'];
            filters.forEach(filterId => {
                const filter = document.getElementById(filterId);
                if (filter) {
                    filter.addEventListener('change', () => {
                        if (document.getElementById('main-search-input').value.trim()) {
                            performSearch();
                        }
                    });
                }
            });
        }

        function showSearchSuggestions(query) {
            const suggestionsContainer = document.getElementById('search-suggestions');
            if (!suggestionsContainer) return;

            // Mock suggestions - in real app, these would come from API
            const suggestions = [
                `${query} در اسناد حقوقی`,
                `${query} در قوانین`,
                `${query} در قراردادها`,
                `${query} در احکام`
            ];

            suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                <div class="suggestion-item" onclick="selectSuggestion('${suggestion}')">
                    <i class="fas fa-search"></i>
                    <span>${suggestion}</span>
                </div>
            `).join('');

            suggestionsContainer.style.display = 'block';
        }

        function hideSearchSuggestions() {
            const suggestionsContainer = document.getElementById('search-suggestions');
            if (suggestionsContainer) {
                suggestionsContainer.style.display = 'none';
            }
        }

        function selectSuggestion(suggestion) {
            const searchInput = document.getElementById('main-search-input');
            if (searchInput) {
                searchInput.value = suggestion;
                hideSearchSuggestions();
                performSearch();
            }
        }

        function performSearch() {
            const searchInput = document.getElementById('main-search-input');
            const query = searchInput ? searchInput.value.trim() : '';

            if (!query) {
                showError('خطا در جستجو', 'لطفاً عبارت جستجو را وارد کنید');
                return;
            }

            // Get advanced filters
            const filters = {
                fileType: document.getElementById('file-type-filter')?.value || '',
                dateRange: document.getElementById('date-range-filter')?.value || '',
                size: document.getElementById('size-filter')?.value || '',
                status: document.getElementById('status-filter')?.value || '',
                confidence: document.getElementById('confidence-filter')?.value || '',
                sort: document.getElementById('sort-filter')?.value || 'relevance'
            };

            showSearchLoading();
            hideSearchSuggestions();

            if (window.searchEngine) {
                window.searchEngine.performSearch(query, filters);
            } else {
                // Fallback search simulation
                simulateSearch(query, filters);
            }

            // Add to search history
            addToSearchHistory(query);
        }

        function simulateSearch(query, filters) {
            setTimeout(() => {
                hideSearchLoading();
                
                // Mock search results
                const results = [
                    {
                        id: 1,
                        title: `سند حقوقی مربوط به ${query}`,
                        filename: `document_${query}_1.pdf`,
                        type: 'pdf',
                        size: 2048576,
                        date: new Date().toISOString(),
                        status: 'completed',
                        confidence: 0.95,
                        excerpt: `این سند شامل اطلاعات مربوط به ${query} است که در تاریخ...`,
                        matches: [query]
                    },
                    {
                        id: 2,
                        title: `قرارداد ${query}`,
                        filename: `contract_${query}_2.doc`,
                        type: 'doc',
                        size: 1048576,
                        date: new Date(Date.now() - 86400000).toISOString(),
                        status: 'completed',
                        confidence: 0.88,
                        excerpt: `قرارداد مربوط به ${query} که در سال...`,
                        matches: [query]
                    }
                ];

                displaySearchResults(results);
            }, 1500);
        }

        function showSearchLoading() {
            const loadingState = document.getElementById('search-loading-state');
            const resultsSection = document.getElementById('search-results-section');
            const emptyState = document.getElementById('search-empty-state');

            if (loadingState) loadingState.style.display = 'flex';
            if (resultsSection) resultsSection.style.display = 'none';
            if (emptyState) emptyState.style.display = 'none';
        }

        function hideSearchLoading() {
            const loadingState = document.getElementById('search-loading-state');
            if (loadingState) loadingState.style.display = 'none';
        }

        function displaySearchResults(results) {
            const resultsSection = document.getElementById('search-results-section');
            const resultsContainer = document.getElementById('results-container');
            const resultsCount = document.getElementById('results-count');
            const emptyState = document.getElementById('search-empty-state');

            if (results.length === 0) {
                if (emptyState) emptyState.style.display = 'flex';
                if (resultsSection) resultsSection.style.display = 'none';
                return;
            }

            if (resultsSection) resultsSection.style.display = 'block';
            if (emptyState) emptyState.style.display = 'none';
            if (resultsCount) resultsCount.textContent = `${results.length} نتیجه`;

            if (resultsContainer) {
                resultsContainer.innerHTML = results.map(result => `
                    <div class="search-result" data-result-id="${result.id}">
                        <div class="result-icon">
                            <i class="fas ${getFileIcon(result.type)}"></i>
                        </div>
                        <div class="result-content">
                            <div class="result-title">${result.title}</div>
                            <div class="result-meta">
                                <span class="result-filename">${result.filename}</span>
                                <span class="result-size">${formatFileSize(result.size)}</span>
                                <span class="result-date">${formatDate(result.date)}</span>
                                <span class="result-confidence">دقت: ${Math.round(result.confidence * 100)}%</span>
                            </div>
                            <div class="result-excerpt">${highlightQuery(result.excerpt, document.getElementById('main-search-input').value)}</div>
                        </div>
                        <div class="result-actions">
                            <button class="btn-icon" onclick="previewResult(${result.id})" title="پیش‌نمایش">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" onclick="downloadResult(${result.id})" title="دانلود">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function highlightQuery(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        function getFileIcon(type) {
            const icons = {
                pdf: 'fa-file-pdf',
                doc: 'fa-file-word',
                image: 'fa-file-image',
                other: 'fa-file'
            };
            return icons[type] || 'fa-file';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 بایت';
            const k = 1024;
            const sizes = ['بایت', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fa-IR');
        }

        function addToSearchHistory(query) {
            const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            const newHistory = [query, ...history.filter(item => item !== query)].slice(0, 10);
            localStorage.setItem('searchHistory', JSON.stringify(newHistory));
            loadSearchHistory();
        }

        function loadSearchHistory() {
            const historyList = document.getElementById('search-history-list');
            const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');

            if (historyList) {
                historyList.innerHTML = history.map(query => `
                    <div class="history-item" onclick="selectHistoryItem('${query}')">
                        <i class="fas fa-history"></i>
                        <span>${query}</span>
                        <button class="btn-icon" onclick="removeHistoryItem('${query}', event)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `).join('');
            }
        }

        function selectHistoryItem(query) {
            const searchInput = document.getElementById('main-search-input');
            if (searchInput) {
                searchInput.value = query;
                performSearch();
            }
        }

        function removeHistoryItem(query, event) {
            event.stopPropagation();
            const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            const newHistory = history.filter(item => item !== query);
            localStorage.setItem('searchHistory', JSON.stringify(newHistory));
            loadSearchHistory();
        }

        function loadSearchAnalytics() {
            // Mock analytics data
            document.getElementById('total-searches').textContent = '1,234';
            document.getElementById('total-results').textContent = '5,678';
            document.getElementById('avg-search-time').textContent = '0.8';
            document.getElementById('success-rate').textContent = '95%';
        }

        function setupSearchEventListeners() {
            // Export results button
            const exportBtn = document.getElementById('export-results-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', () => {
                    if (window.searchEngine) {
                        window.searchEngine.exportSearchResults();
                    } else {
                        showSuccess('صادرات', 'نتایج جستجو با موفقیت صادر شد');
                    }
                });
            }

            // Save search button
            const saveSearchBtn = document.getElementById('save-search-btn');
            if (saveSearchBtn) {
                saveSearchBtn.addEventListener('click', () => {
                    const query = document.getElementById('main-search-input').value.trim();
                    if (query) {
                        const savedSearches = JSON.parse(localStorage.getItem('savedSearches') || '[]');
                        savedSearches.push({
                            query,
                            date: new Date().toISOString(),
                            filters: getCurrentFilters()
                        });
                        localStorage.setItem('savedSearches', JSON.stringify(savedSearches));
                        showSuccess('ذخیره شد', 'جستجو با موفقیت ذخیره شد');
                    }
                });
            }

            // Clear history button
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            if (clearHistoryBtn) {
                clearHistoryBtn.addEventListener('click', () => {
                    localStorage.removeItem('searchHistory');
                    loadSearchHistory();
                    showSuccess('پاک شد', 'تاریخچه جستجو پاک شد');
                });
            }

            // Mobile menu toggle
            const mobileToggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');

            if (mobileToggle && sidebar) {
                mobileToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('open');
                    overlay.classList.toggle('hidden');
                });
            }

            if (overlay) {
                overlay.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    overlay.classList.add('hidden');
                });
            }

            // Notification panel
            const notificationBell = document.getElementById('notification-bell');
            const notificationPanel = document.getElementById('notification-panel');
            const closePanel = document.getElementById('close-notification-panel');

            if (notificationBell && notificationPanel) {
                notificationBell.addEventListener('click', () => {
                    notificationPanel.classList.toggle('hidden');
                });
            }

            if (closePanel && notificationPanel) {
                closePanel.addEventListener('click', () => {
                    notificationPanel.classList.add('hidden');
                });
            }

            // Document preview modal
            const previewModal = document.getElementById('document-preview-modal');
            const closePreviewBtn = document.getElementById('close-preview-modal');

            if (closePreviewBtn && previewModal) {
                closePreviewBtn.addEventListener('click', () => {
                    previewModal.classList.add('hidden');
                });
            }

            if (previewModal) {
                previewModal.addEventListener('click', (e) => {
                    if (e.target === previewModal) {
                        previewModal.classList.add('hidden');
                    }
                });
            }
        }

        function getCurrentFilters() {
            return {
                fileType: document.getElementById('file-type-filter')?.value || '',
                dateRange: document.getElementById('date-range-filter')?.value || '',
                size: document.getElementById('size-filter')?.value || '',
                status: document.getElementById('status-filter')?.value || '',
                confidence: document.getElementById('confidence-filter')?.value || '',
                sort: document.getElementById('sort-filter')?.value || 'relevance'
            };
        }

        function previewResult(resultId) {
            // Mock preview functionality
            const previewModal = document.getElementById('document-preview-modal');
            const previewTitle = document.getElementById('preview-title');
            const previewContent = document.getElementById('preview-content');

            if (previewTitle) previewTitle.textContent = 'پیش‌نمایش سند';
            if (previewContent) {
                previewContent.innerHTML = `
                    <div class="preview-info">
                        <p><strong>نام فایل:</strong> document_${resultId}.pdf</p>
                        <p><strong>نوع:</strong> PDF</p>
                        <p><strong>حجم:</strong> 2.0 MB</p>
                        <p><strong>تاریخ:</strong> ${new Date().toLocaleDateString('fa-IR')}</p>
                    </div>
                    <div class="preview-text">
                        <p>این یک پیش‌نمایش نمونه از محتوای سند است. در محیط واقعی، محتوای واقعی فایل نمایش داده خواهد شد.</p>
                    </div>
                `;
            }
            if (previewModal) previewModal.classList.remove('hidden');
        }

        function downloadResult(resultId) {
            showSuccess('دانلود', 'فایل با موفقیت دانلود شد');
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function showSuccess(title, message) {
            if (window.notificationManager) {
                window.notificationManager.showSuccess(title, message);
            } else {
                alert(`${title}: ${message}`);
            }
        }

        function showError(title, message) {
            if (window.notificationManager) {
                window.notificationManager.showError(title, message);
            } else {
                alert(`${title}: ${message}`);
            }
        }

        // Global functions for onclick handlers
        window.selectSuggestion = selectSuggestion;
        window.previewResult = previewResult;
        window.downloadResult = downloadResult;
        window.selectHistoryItem = selectHistoryItem;
        window.removeHistoryItem = removeHistoryItem;
    </script>
</body>
</html>