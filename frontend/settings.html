<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تنظیمات | سامانه هوشمند</title>
    
    <!-- Preconnect for better performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- فونت و آیکون‌ها -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar" id="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <a href="index.html" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-gavel"></i>
                    </div>
                    <span class="logo-text">داشبورد حقوقی</span>
                </a>
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="main-nav">
                <div class="nav-section">
                    <h4 class="nav-title">اصلی</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link" data-nav="dashboard">
                                <span class="nav-icon"><i class="fas fa-tachometer-alt"></i></span>
                                <span>داشبورد</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="documents.html" class="nav-link" data-nav="documents">
                                <span class="nav-icon"><i class="fas fa-file-alt"></i></span>
                                <span>مدیریت اسناد</span>
                                <span class="nav-badge" data-badge="documents">0</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="upload.html" class="nav-link" data-nav="upload">
                                <span class="nav-icon"><i class="fas fa-cloud-upload-alt"></i></span>
                                <span>آپلود فایل</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="search.html" class="nav-link" data-nav="search">
                                <span class="nav-icon"><i class="fas fa-search"></i></span>
                                <span>جستجو</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="analytics.html" class="nav-link" data-nav="analytics">
                                <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                                <span>تحلیل و گزارش</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h4 class="nav-title">سیستم</h4>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="system-health.html" class="nav-link" data-nav="systemHealth">
                                <span class="nav-icon"><i class="fas fa-heartbeat"></i></span>
                                <span>وضعیت سیستم</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="settings.html" class="nav-link active" data-nav="settings">
                                <span class="nav-icon"><i class="fas fa-cog"></i></span>
                                <span>تنظیمات</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 class="header-title">تنظیمات</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" id="reset-settings-btn">
                        <i class="fas fa-undo"></i>
                        بازنشانی
                    </button>
                    <button class="btn btn-primary" id="save-settings-btn">
                        <i class="fas fa-save"></i>
                        ذخیره تنظیمات
                    </button>
                    <button class="btn-icon" id="user-menu-btn">
                        <i class="fas fa-user-circle"></i>
                    </button>
                    <button class="btn-icon" id="notification-bell">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notification-badge">0</span>
                    </button>
                </div>
            </header>

            <!-- Breadcrumbs -->
            <div class="breadcrumb-container" id="breadcrumb-container">
                <a href="index.html" class="breadcrumb-item">
                    <i class="fas fa-home"></i>
                    <span>خانه</span>
                </a>
                <i class="fas fa-angle-left mx-2 text-gray-400"></i>
                <span class="breadcrumb-item active" aria-current="page">تنظیمات</span>
            </div>

            <!-- Settings Tabs -->
            <section class="settings-section">
                <div class="settings-tabs">
                    <button class="tab-btn active" data-tab="general">عمومی</button>
                    <button class="tab-btn" data-tab="appearance">ظاهر</button>
                    <button class="tab-btn" data-tab="notifications">اعلان‌ها</button>
                    <button class="tab-btn" data-tab="security">امنیت</button>
                    <button class="tab-btn" data-tab="advanced">پیشرفته</button>
                </div>

                <div class="tab-content">
                    <!-- General Settings -->
                    <div class="tab-pane active" id="general-tab">
                        <div class="settings-group">
                            <h3>تنظیمات عمومی</h3>
                            
                            <div class="form-group">
                                <label for="language-select">زبان:</label>
                                <select id="language-select" class="form-select">
                                    <option value="fa" selected>فارسی</option>
                                    <option value="en">English</option>
                                    <option value="ar">العربية</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="timezone-select">منطقه زمانی:</label>
                                <select id="timezone-select" class="form-select">
                                    <option value="Asia/Tehran" selected>تهران (UTC+3:30)</option>
                                    <option value="UTC">UTC</option>
                                    <option value="Europe/London">لندن (UTC+0)</option>
                                    <option value="America/New_York">نیویورک (UTC-5)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="date-format">فرمت تاریخ:</label>
                                <select id="date-format" class="form-select">
                                    <option value="jalali" selected>شمسی</option>
                                    <option value="gregorian">میلادی</option>
                                    <option value="both">هر دو</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="auto-save">ذخیره خودکار:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="auto-save" checked>
                                    <label for="auto-save"></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="auto-save-interval">فاصله ذخیره خودکار (دقیقه):</label>
                                <input type="number" id="auto-save-interval" class="form-input" value="5" min="1" max="60">
                            </div>
                        </div>
                    </div>

                    <!-- Appearance Settings -->
                    <div class="tab-pane" id="appearance-tab">
                        <div class="settings-group">
                            <h3>تنظیمات ظاهر</h3>
                            
                            <div class="form-group">
                                <label for="theme-select">تم:</label>
                                <select id="theme-select" class="form-select">
                                    <option value="auto" selected>خودکار</option>
                                    <option value="light">روشن</option>
                                    <option value="dark">تاریک</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="color-scheme">رنگ اصلی:</label>
                                <div class="color-picker">
                                    <input type="color" id="color-scheme" value="#3b82f6">
                                    <span class="color-preview"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="font-size">اندازه فونت:</label>
                                <select id="font-size" class="form-select">
                                    <option value="small">کوچک</option>
                                    <option value="medium" selected>متوسط</option>
                                    <option value="large">بزرگ</option>
                                    <option value="xlarge">خیلی بزرگ</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="animation-toggle">انیمیشن‌ها:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="animation-toggle" checked>
                                    <label for="animation-toggle"></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="compact-mode">حالت فشرده:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="compact-mode">
                                    <label for="compact-mode"></label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Settings -->
                    <div class="tab-pane" id="notifications-tab">
                        <div class="settings-group">
                            <h3>تنظیمات اعلان‌ها</h3>
                            
                            <div class="form-group">
                                <label for="notifications-enabled">فعال‌سازی اعلان‌ها:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="notifications-enabled" checked>
                                    <label for="notifications-enabled"></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="sound-notifications">اعلان‌های صوتی:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="sound-notifications" checked>
                                    <label for="sound-notifications"></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="email-notifications">اعلان‌های ایمیل:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="email-notifications">
                                    <label for="email-notifications"></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="notification-types">نوع اعلان‌ها:</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-item">
                                        <input type="checkbox" checked> آپلود فایل
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" checked> تکمیل پردازش
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" checked> خطاهای سیستم
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox"> به‌روزرسانی‌ها
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="notification-duration">مدت نمایش اعلان (ثانیه):</label>
                                <input type="number" id="notification-duration" class="form-input" value="5" min="1" max="30">
                            </div>
                        </div>
                    </div>

                    <!-- Security Settings -->
                    <div class="tab-pane" id="security-tab">
                        <div class="settings-group">
                            <h3>تنظیمات امنیت</h3>
                            
                            <div class="form-group">
                                <label for="session-timeout">مدت زمان نشست (دقیقه):</label>
                                <input type="number" id="session-timeout" class="form-input" value="30" min="5" max="480">
                            </div>

                            <div class="form-group">
                                <label for="two-factor-auth">احراز هویت دو مرحله‌ای:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="two-factor-auth">
                                    <label for="two-factor-auth"></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="password-change">تغییر رمز عبور:</label>
                                <button class="btn btn-secondary" id="change-password-btn">
                                    <i class="fas fa-key"></i>
                                    تغییر رمز عبور
                                </button>
                            </div>

                            <div class="form-group">
                                <label for="login-history">تاریخچه ورود:</label>
                                <button class="btn btn-secondary" id="view-login-history-btn">
                                    <i class="fas fa-history"></i>
                                    مشاهده تاریخچه
                                </button>
                            </div>

                            <div class="form-group">
                                <label for="data-encryption">رمزگذاری داده‌ها:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="data-encryption" checked>
                                    <label for="data-encryption"></label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Settings -->
                    <div class="tab-pane" id="advanced-tab">
                        <div class="settings-group">
                            <h3>تنظیمات پیشرفته</h3>
                            
                            <div class="form-group">
                                <label for="debug-mode">حالت دیباگ:</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="debug-mode">
                                    <label for="debug-mode"></label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="cache-size">اندازه کش (MB):</label>
                                <input type="number" id="cache-size" class="form-input" value="100" min="10" max="1000">
                            </div>

                            <div class="form-group">
                                <label for="api-timeout">تایم‌اوت API (ثانیه):</label>
                                <input type="number" id="api-timeout" class="form-input" value="30" min="5" max="300">
                            </div>

                            <div class="form-group">
                                <label for="max-upload-size">حداکثر حجم آپلود (MB):</label>
                                <input type="number" id="max-upload-size" class="form-input" value="50" min="1" max="500">
                            </div>

                            <div class="form-group">
                                <label for="concurrent-uploads">تعداد آپلود همزمان:</label>
                                <input type="number" id="concurrent-uploads" class="form-input" value="3" min="1" max="10">
                            </div>

                            <div class="form-group">
                                <label for="export-format">فرمت پیش‌فرض صادرات:</label>
                                <select id="export-format" class="form-select">
                                    <option value="pdf" selected>PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="csv">CSV</option>
                                    <option value="json">JSON</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Management -->
            <section class="data-management">
                <div class="management-header">
                    <h3>مدیریت داده‌ها</h3>
                </div>

                <div class="management-grid">
                    <div class="management-card">
                        <div class="card-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="card-content">
                            <h4>صادرات داده‌ها</h4>
                            <p>دانلود تمام داده‌های شخصی و تنظیمات</p>
                            <button class="btn btn-secondary" id="export-data-btn">
                                <i class="fas fa-download"></i>
                                صادرات
                            </button>
                        </div>
                    </div>

                    <div class="management-card">
                        <div class="card-icon">
                            <i class="fas fa-upload"></i>
                        </div>
                        <div class="card-content">
                            <h4>واردات داده‌ها</h4>
                            <p>بازگردانی تنظیمات از فایل پشتیبان</p>
                            <button class="btn btn-secondary" id="import-data-btn">
                                <i class="fas fa-upload"></i>
                                واردات
                            </button>
                        </div>
                    </div>

                    <div class="management-card">
                        <div class="card-icon">
                            <i class="fas fa-trash"></i>
                        </div>
                        <div class="card-content">
                            <h4>پاک کردن کش</h4>
                            <p>پاک کردن تمام داده‌های موقت</p>
                            <button class="btn btn-danger" id="clear-cache-btn">
                                <i class="fas fa-trash"></i>
                                پاک کردن
                            </button>
                        </div>
                    </div>

                    <div class="management-card">
                        <div class="card-icon">
                            <i class="fas fa-redo"></i>
                        </div>
                        <div class="card-content">
                            <h4>بازنشانی کامل</h4>
                            <p>بازگردانی تمام تنظیمات به حالت پیش‌فرض</p>
                            <button class="btn btn-danger" id="reset-all-btn">
                                <i class="fas fa-redo"></i>
                                بازنشانی
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Account Information -->
            <section class="account-info">
                <div class="account-header">
                    <h3>اطلاعات حساب کاربری</h3>
                </div>

                <div class="account-details">
                    <div class="detail-item">
                        <span class="detail-label">نام کاربری:</span>
                        <span class="detail-value">admin@legal.com</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">نام کامل:</span>
                        <span class="detail-value">مدیر سیستم</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">نقش:</span>
                        <span class="detail-value">مدیر ارشد</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">تاریخ عضویت:</span>
                        <span class="detail-value">1402/01/15</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">آخرین ورود:</span>
                        <span class="detail-value">1402/10/20 - 14:30</span>
                    </div>
                </div>

                <div class="account-actions">
                    <button class="btn btn-secondary" id="edit-profile-btn">
                        <i class="fas fa-edit"></i>
                        ویرایش پروفایل
                    </button>
                    <button class="btn btn-danger" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        خروج
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Notification Panel -->
    <div id="notification-panel" class="notification-panel hidden">
        <div class="notification-header">
            <h3>اعلان‌ها</h3>
            <button class="close-btn" id="close-notification-panel">×</button>
        </div>
        <div class="notification-list" id="notification-list"></div>
        <div class="notification-footer">
            <button class="btn btn-secondary" id="mark-all-read">علامت‌گذاری همه</button>
            <button class="btn btn-danger" id="clear-all-notifications">پاک کردن همه</button>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay hidden"></div>

    <!-- Change Password Modal -->
    <div id="change-password-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>تغییر رمز عبور</h3>
                <button class="close-btn" id="close-password-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="current-password">رمز عبور فعلی:</label>
                    <input type="password" id="current-password" class="form-input">
                </div>
                <div class="form-group">
                    <label for="new-password">رمز عبور جدید:</label>
                    <input type="password" id="new-password" class="form-input">
                </div>
                <div class="form-group">
                    <label for="confirm-password">تایید رمز عبور جدید:</label>
                    <input type="password" id="confirm-password" class="form-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-password-btn">انصراف</button>
                <button class="btn btn-primary" id="confirm-password-btn">
                    <i class="fas fa-key"></i>
                    تغییر رمز عبور
                </button>
            </div>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div id="import-data-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>واردات داده‌ها</h3>
                <button class="close-btn" id="close-import-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="import-file">انتخاب فایل:</label>
                    <input type="file" id="import-file" class="form-input" accept=".json,.zip">
                </div>
                <div class="form-group">
                    <label for="import-options">گزینه‌های واردات:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" checked> تنظیمات
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" checked> داده‌های شخصی
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox"> تاریخچه
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-import-btn">انصراف</button>
                <button class="btn btn-primary" id="confirm-import-btn">
                    <i class="fas fa-upload"></i>
                    واردات
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/core.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/state-manager.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/document-manager.js"></script>
    <script src="js/file-handler.js"></script>
    <script src="js/search-engine.js"></script>
    <script src="js/chart-manager.js"></script>

    <!-- Initialize Settings Page -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing Settings Page...');

            // Initialize all managers
            const managers = {
                core: window.dashboardCore,
                api: window.apiClient,
                state: window.stateManager,
                navigation: window.navigationManager,
                notifications: window.notificationManager,
                documents: window.documentManager,
                files: window.fileHandler,
                search: window.searchEngine,
                charts: window.chartManager
            };

            // Set up cross-component communication
            managers.core.broadcast('settings:initialized', { managers });

            // Initialize settings page functionality
            initializeSettingsPage();

            console.log('✅ Settings page initialized successfully');
        });

        function initializeSettingsPage() {
            // Load current settings
            loadCurrentSettings();

            // Set up tabs
            setupSettingsTabs();

            // Set up event listeners
            setupSettingsEventListeners();

            // Set up form validation
            setupFormValidation();
        }

        function loadCurrentSettings() {
            // Load settings from localStorage or API
            const settings = {
                language: 'fa',
                timezone: 'Asia/Tehran',
                dateFormat: 'jalali',
                autoSave: true,
                autoSaveInterval: 5,
                theme: 'auto',
                colorScheme: '#3b82f6',
                fontSize: 'medium',
                animations: true,
                compactMode: false,
                notificationsEnabled: true,
                soundNotifications: true,
                emailNotifications: false,
                sessionTimeout: 30,
                twoFactorAuth: false,
                dataEncryption: true,
                debugMode: false,
                cacheSize: 100,
                apiTimeout: 30,
                maxUploadSize: 50,
                concurrentUploads: 3,
                exportFormat: 'pdf'
            };

            // Apply settings to form elements
            applySettingsToForm(settings);
        }

        function applySettingsToForm(settings) {
            // Apply settings to form elements
            Object.keys(settings).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = settings[key];
                    } else if (element.type === 'color') {
                        element.value = settings[key];
                        updateColorPreview(settings[key]);
                    } else {
                        element.value = settings[key];
                    }
                }
            });
        }

        function updateColorPreview(color) {
            const preview = document.querySelector('.color-preview');
            if (preview) {
                preview.style.backgroundColor = color;
            }
        }

        function setupSettingsTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.dataset.tab;
                    
                    // Remove active class from all buttons and panes
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanes.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding pane
                    btn.classList.add('active');
                    document.getElementById(`${targetTab}-tab`).classList.add('active');
                });
            });
        }

        function setupSettingsEventListeners() {
            // Save settings button
            const saveBtn = document.getElementById('save-settings-btn');
            if (saveBtn) {
                saveBtn.addEventListener('click', () => {
                    saveSettings();
                });
            }

            // Reset settings button
            const resetBtn = document.getElementById('reset-settings-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    resetSettings();
                });
            }

            // Color scheme picker
            const colorPicker = document.getElementById('color-scheme');
            if (colorPicker) {
                colorPicker.addEventListener('change', (e) => {
                    updateColorPreview(e.target.value);
                });
            }

            // Change password button
            const changePasswordBtn = document.getElementById('change-password-btn');
            if (changePasswordBtn) {
                changePasswordBtn.addEventListener('click', () => {
                    showChangePasswordModal();
                });
            }

            // Export data button
            const exportDataBtn = document.getElementById('export-data-btn');
            if (exportDataBtn) {
                exportDataBtn.addEventListener('click', () => {
                    exportUserData();
                });
            }

            // Import data button
            const importDataBtn = document.getElementById('import-data-btn');
            if (importDataBtn) {
                importDataBtn.addEventListener('click', () => {
                    showImportDataModal();
                });
            }

            // Clear cache button
            const clearCacheBtn = document.getElementById('clear-cache-btn');
            if (clearCacheBtn) {
                clearCacheBtn.addEventListener('click', () => {
                    clearCache();
                });
            }

            // Reset all button
            const resetAllBtn = document.getElementById('reset-all-btn');
            if (resetAllBtn) {
                resetAllBtn.addEventListener('click', () => {
                    resetAllSettings();
                });
            }

            // Edit profile button
            const editProfileBtn = document.getElementById('edit-profile-btn');
            if (editProfileBtn) {
                editProfileBtn.addEventListener('click', () => {
                    editProfile();
                });
            }

            // Logout button
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    logout();
                });
            }

            // Modal event listeners
            setupModalEventListeners();

            // Mobile menu toggle
            const mobileToggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');

            if (mobileToggle && sidebar) {
                mobileToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('open');
                    overlay.classList.toggle('hidden');
                });
            }

            if (overlay) {
                overlay.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    overlay.classList.add('hidden');
                });
            }

            // Notification panel
            const notificationBell = document.getElementById('notification-bell');
            const notificationPanel = document.getElementById('notification-panel');
            const closePanel = document.getElementById('close-notification-panel');

            if (notificationBell && notificationPanel) {
                notificationBell.addEventListener('click', () => {
                    notificationPanel.classList.toggle('hidden');
                });
            }

            if (closePanel && notificationPanel) {
                closePanel.addEventListener('click', () => {
                    notificationPanel.classList.add('hidden');
                });
            }
        }

        function setupModalEventListeners() {
            // Change password modal
            const passwordModal = document.getElementById('change-password-modal');
            const closePasswordBtn = document.getElementById('close-password-modal');
            const cancelPasswordBtn = document.getElementById('cancel-password-btn');
            const confirmPasswordBtn = document.getElementById('confirm-password-btn');

            if (closePasswordBtn && passwordModal) {
                closePasswordBtn.addEventListener('click', () => {
                    passwordModal.classList.add('hidden');
                });
            }

            if (cancelPasswordBtn && passwordModal) {
                cancelPasswordBtn.addEventListener('click', () => {
                    passwordModal.classList.add('hidden');
                });
            }

            if (confirmPasswordBtn && passwordModal) {
                confirmPasswordBtn.addEventListener('click', () => {
                    changePassword();
                });
            }

            if (passwordModal) {
                passwordModal.addEventListener('click', (e) => {
                    if (e.target === passwordModal) {
                        passwordModal.classList.add('hidden');
                    }
                });
            }

            // Import data modal
            const importModal = document.getElementById('import-data-modal');
            const closeImportBtn = document.getElementById('close-import-modal');
            const cancelImportBtn = document.getElementById('cancel-import-btn');
            const confirmImportBtn = document.getElementById('confirm-import-btn');

            if (closeImportBtn && importModal) {
                closeImportBtn.addEventListener('click', () => {
                    importModal.classList.add('hidden');
                });
            }

            if (cancelImportBtn && importModal) {
                cancelImportBtn.addEventListener('click', () => {
                    importModal.classList.add('hidden');
                });
            }

            if (confirmImportBtn && importModal) {
                confirmImportBtn.addEventListener('click', () => {
                    importUserData();
                });
            }

            if (importModal) {
                importModal.addEventListener('click', (e) => {
                    if (e.target === importModal) {
                        importModal.classList.add('hidden');
                    }
                });
            }
        }

        function setupFormValidation() {
            // Add form validation logic here
            console.log('Form validation setup complete');
        }

        function saveSettings() {
            const settings = collectFormSettings();
            
            // Save to localStorage
            localStorage.setItem('userSettings', JSON.stringify(settings));
            
            // Save to API if available
            if (window.apiClient) {
                window.apiClient.saveSettings(settings)
                    .then(() => {
                        showSuccess('ذخیره شد', 'تنظیمات با موفقیت ذخیره شد');
                    })
                    .catch(error => {
                        showError('خطا در ذخیره', 'خطا در ذخیره تنظیمات');
                    });
            } else {
                showSuccess('ذخیره شد', 'تنظیمات با موفقیت ذخیره شد');
            }
        }

        function collectFormSettings() {
            const settings = {};
            
            // Collect all form values
            const formElements = document.querySelectorAll('input, select, textarea');
            formElements.forEach(element => {
                if (element.id) {
                    if (element.type === 'checkbox') {
                        settings[element.id] = element.checked;
                    } else {
                        settings[element.id] = element.value;
                    }
                }
            });
            
            return settings;
        }

        function resetSettings() {
            if (confirm('آیا مطمئن هستید که می‌خواهید تنظیمات را بازنشانی کنید؟')) {
                // Reset to default settings
                const defaultSettings = {
                    language: 'fa',
                    timezone: 'Asia/Tehran',
                    dateFormat: 'jalali',
                    autoSave: true,
                    autoSaveInterval: 5,
                    theme: 'auto',
                    colorScheme: '#3b82f6',
                    fontSize: 'medium',
                    animations: true,
                    compactMode: false
                };
                
                applySettingsToForm(defaultSettings);
                showSuccess('بازنشانی شد', 'تنظیمات به حالت پیش‌فرض بازگردانده شد');
            }
        }

        function showChangePasswordModal() {
            const modal = document.getElementById('change-password-modal');
            if (modal) {
                modal.classList.remove('hidden');
                // Clear form
                document.getElementById('current-password').value = '';
                document.getElementById('new-password').value = '';
                document.getElementById('confirm-password').value = '';
            }
        }

        function changePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
                showError('خطا', 'لطفاً تمام فیلدها را پر کنید');
                return;
            }

            if (newPassword !== confirmPassword) {
                showError('خطا', 'رمز عبور جدید و تایید آن مطابقت ندارند');
                return;
            }

            if (newPassword.length < 8) {
                showError('خطا', 'رمز عبور جدید باید حداقل 8 کاراکتر باشد');
                return;
            }

            // Simulate password change
            showLoadingState();
            setTimeout(() => {
                hideLoadingState();
                showSuccess('تغییر رمز عبور', 'رمز عبور با موفقیت تغییر یافت');
                document.getElementById('change-password-modal').classList.add('hidden');
            }, 2000);
        }

        function exportUserData() {
            const userData = {
                settings: collectFormSettings(),
                profile: {
                    username: 'admin@legal.com',
                    fullName: 'مدیر سیستم',
                    role: 'مدیر ارشد',
                    joinDate: '1402/01/15'
                },
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(userData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'user-data.json';
            link.click();
            URL.revokeObjectURL(url);

            showSuccess('صادرات موفق', 'داده‌های کاربری با موفقیت صادر شد');
        }

        function showImportDataModal() {
            const modal = document.getElementById('import-data-modal');
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        function importUserData() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];

            if (!file) {
                showError('خطا', 'لطفاً فایلی را انتخاب کنید');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Apply imported settings
                    if (data.settings) {
                        applySettingsToForm(data.settings);
                    }
                    
                    showSuccess('واردات موفق', 'داده‌ها با موفقیت وارد شدند');
                    document.getElementById('import-data-modal').classList.add('hidden');
                } catch (error) {
                    showError('خطا', 'فایل انتخاب شده معتبر نیست');
                }
            };
            reader.readAsText(file);
        }

        function clearCache() {
            if (confirm('آیا مطمئن هستید که می‌خواهید کش را پاک کنید؟')) {
                showLoadingState();
                setTimeout(() => {
                    hideLoadingState();
                    showSuccess('پاک شد', 'کش با موفقیت پاک شد');
                }, 1500);
            }
        }

        function resetAllSettings() {
            if (confirm('آیا مطمئن هستید که می‌خواهید تمام تنظیمات را بازنشانی کنید؟ این عمل قابل بازگشت نیست.')) {
                showLoadingState();
                setTimeout(() => {
                    hideLoadingState();
                    loadCurrentSettings(); // Reload default settings
                    showSuccess('بازنشانی شد', 'تمام تنظیمات به حالت پیش‌فرض بازگردانده شد');
                }, 2000);
            }
        }

        function editProfile() {
            showSuccess('ویرایش پروفایل', 'این قابلیت در نسخه‌های آینده اضافه خواهد شد');
        }

        function logout() {
            if (confirm('آیا مطمئن هستید که می‌خواهید از حساب کاربری خارج شوید؟')) {
                showLoadingState();
                setTimeout(() => {
                    hideLoadingState();
                    // Redirect to login page or show logout message
                    showSuccess('خروج', 'با موفقیت از حساب کاربری خارج شدید');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                }, 1000);
            }
        }

        function showLoadingState() {
            const saveBtn = document.getElementById('save-settings-btn');
            if (saveBtn) {
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> در حال ذخیره...';
                saveBtn.disabled = true;
            }
        }

        function hideLoadingState() {
            const saveBtn = document.getElementById('save-settings-btn');
            if (saveBtn) {
                saveBtn.innerHTML = '<i class="fas fa-save"></i> ذخیره تنظیمات';
                saveBtn.disabled = false;
            }
        }

        function showSuccess(title, message) {
            if (window.notificationManager) {
                window.notificationManager.showSuccess(title, message);
            } else {
                alert(`${title}: ${message}`);
            }
        }

        function showError(title, message) {
            if (window.notificationManager) {
                window.notificationManager.showError(title, message);
            } else {
                alert(`${title}: ${message}`);
            }
        }
    </script>
</body>
</html>